{"version":3,"names":["ErrorCatalog","ErrorLevel","ErrorHandler","constructor","eventSystem","errors","policy","logLevel","WARNING","throwLevel","ERROR","emitAll","historyLimit","setErrorPolicy","newPolicy","emit","createError","errorCode","customMessage","context","errorTemplate","getErrorByCode","Error","error","timestamp","Date","now","message","_handleError","length","shift","push","_logError","_emitErrorEvent","_throwIfRequired","level","FATAL","console","warn","INFO","info","details","getErrorHistory","limit","slice","clearErrorHistory","getErrorsByLevel","filter","convertToNativeError","errorStructure","nativeError","name","code"],"sources":["ErrorHandler.js"],"sourcesContent":["import ErrorCatalog from './ErrorCatalog';\nimport ErrorLevel from './ErrorLevel';\n\nexport default class ErrorHandler {\n  constructor(eventSystem = null) {\n    this.eventSystem = eventSystem;\n    this.errors = [];\n    this.policy = {\n      logLevel: ErrorLevel.WARNING,\n      throwLevel: ErrorLevel.ERROR,\n      emitAll: true,\n      historyLimit: 100\n    };\n  }\n\n  setErrorPolicy(newPolicy = {}) {\n    this.policy = { ...this.policy, ...newPolicy };\n    \n    if (this.eventSystem) {\n      this.eventSystem.emit('error.policy.change', { policy: this.policy });\n    }\n  }\n\n  createError(errorCode, customMessage = null, context = {}) {\n    const errorTemplate = ErrorCatalog.getErrorByCode(errorCode);\n    if (!errorTemplate) {\n      throw new Error(`無効なエラーコード: ${errorCode}`);\n    }\n\n    const error = {\n      ...errorTemplate,\n      timestamp: Date.now(),\n      context: context,\n      ...(customMessage && { message: customMessage })\n    };\n\n    this._handleError(error);\n    return error;\n  }\n\n  _handleError(error) {\n    // エラー履歴の管理\n    if (this.errors.length >= this.policy.historyLimit) {\n      this.errors.shift();\n    }\n    this.errors.push(error);\n\n    // ログ出力\n    this._logError(error);\n\n    // イベント発火\n    this._emitErrorEvent(error);\n\n    // エラーレベルに応じて例外を投げる\n    this._throwIfRequired(error);\n  }\n\n  _logError(error) {\n    switch (error.level) {\n      case ErrorLevel.FATAL:\n        console.error('FATAL:', error);\n        break;\n      case ErrorLevel.ERROR:\n        console.error('ERROR:', error);\n        break;\n      case ErrorLevel.WARNING:\n        console.warn('WARNING:', error);\n        break;\n      case ErrorLevel.INFO:\n        console.info('INFO:', error);\n        break;\n    }\n  }\n\n  _emitErrorEvent(error) {\n    if (this.eventSystem && (this.policy.emitAll || error.level >= this.policy.logLevel)) {\n      this.eventSystem.emit('error', error);\n      this.eventSystem.emit(`error.${error.level}`, error);\n    }\n  }\n\n  _throwIfRequired(error) {\n    if (error.level >= this.policy.throwLevel) {\n      throw new Error(`${error.message}: ${error.details}`);\n    }\n  }\n\n  getErrorHistory(limit = null) {\n    return limit ? this.errors.slice(-limit) : [...this.errors];\n  }\n\n  clearErrorHistory() {\n    this.errors = [];\n  }\n\n  getErrorsByLevel(level) {\n    return this.errors.filter(error => error.level === level);\n  }\n\n  convertToNativeError(errorStructure) {\n    const nativeError = new Error(errorStructure.message);\n    nativeError.name = 'WerewolfGameError';\n    nativeError.code = errorStructure.code;\n    nativeError.details = errorStructure.details;\n    nativeError.context = errorStructure.context;\n    return nativeError;\n  }\n}\n"],"mappings":"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","ignoreList":[]}