e6b248c49cfbc5d9a54df3dc0e9fc7e1
/**
 * EventSystem - Core event management module for the werewolf game GM support library
 *
 * This module provides the foundation for the event-driven architecture,
 * enabling communication between different modules through events.
 */

class EventSystem {
  /**
   * Creates a new EventSystem instance
   * @param {Object} options - Configuration options
   * @param {boolean} [options.enableNamespaces=true] - Enable hierarchical event namespaces
   * @param {boolean} [options.debugMode=false] - Enable debug mode with event history
   * @param {boolean} [options.enableWildcards=false] - Enable wildcard event matching
   * @param {number} [options.historyLimit=100] - Maximum number of events to keep in history
   * @param {boolean} [options.shareOnceListeners=false] - Whether once listeners should be shared across event names
   */
  constructor(options = {}) {
    // Default options
    this.options = {
      enableNamespaces: true,
      debugMode: false,
      enableWildcards: false,
      historyLimit: 100,
      shareOnceListeners: false,
      ...options
    };

    // Map to store event listeners: { eventName => [{ callback, once, priority }] }
    this.listeners = new Map();

    // Event history for debugging (only active in debug mode)
    this.eventHistory = [];

    // Flag to track if we're currently emitting an event (to handle nested emissions)
    this._emitting = false;

    // Queue for listeners to be added/removed during emission
    this._pendingAdditions = [];
    this._pendingRemovals = [];

    // Set to track which callbacks have been invoked during an emission cycle
    this._invokedCallbacks = new Set();
  }

  /**
   * Register an event listener
   * @param {string} eventName - Name of the event to listen for
   * @param {Function} callback - Function to call when the event is emitted
   * @param {number} [priority=0] - Priority of the listener (higher executes first)
   * @return {EventSystem} - Returns this instance for chaining
   * @throws {Error} If eventName is not a string or callback is not a function
   */
  on(eventName, callback, priority = 0) {
    // Validate arguments
    if (typeof eventName !== 'string' || eventName.trim() === '') {
      throw new Error('Event name must be a non-empty string');
    }
    if (typeof callback !== 'function') {
      throw new Error('Callback must be a function');
    }

    // If we're currently emitting, queue the addition
    if (this._emitting) {
      this._pendingAdditions.push({
        eventName,
        callback,
        priority,
        once: false
      });
      return this;
    }

    // Get or create the listeners array for this event
    if (!this.listeners.has(eventName)) {
      this.listeners.set(eventName, []);
    }
    const listeners = this.listeners.get(eventName);

    // Check for duplicate listener
    const existingIndex = listeners.findIndex(listener => listener.callback === callback);
    if (existingIndex !== -1) {
      // Update the existing listener's priority
      listeners[existingIndex].priority = priority;
    } else {
      // Add the new listener
      listeners.push({
        callback,
        once: false,
        priority
      });

      // Sort listeners by priority (highest first)
      listeners.sort((a, b) => b.priority - a.priority);
    }
    return this;
  }

  /**
   * Register a one-time event listener that will be removed after execution
   * @param {string} eventName - Name of the event to listen for
   * @param {Function} callback - Function to call when the event is emitted
   * @param {number} [priority=0] - Priority of the listener (higher executes first)
   * @return {EventSystem} - Returns this instance for chaining
   * @throws {Error} If eventName is not a string or callback is not a function
   */
  once(eventName, callback, priority = 0) {
    // Validate arguments
    if (typeof eventName !== 'string' || eventName.trim() === '') {
      throw new Error('Event name must be a non-empty string');
    }
    if (typeof callback !== 'function') {
      throw new Error('Callback must be a function');
    }

    // Tracked callbacks for once - global to instance
    if (!this._onceTracker) {
      this._onceTracker = new Map();
    }

    // Each original callback gets its own wrapper
    let wrapper;

    // Check if we already have a wrapper for this callback
    if (this._onceTracker.has(callback)) {
      wrapper = this._onceTracker.get(callback);

      // Add this event name to the wrapper's tracked events
      if (!wrapper._eventNames) {
        wrapper._eventNames = new Set();
      }
      wrapper._eventNames.add(eventName);
    } else {
      // Create a special bound version that will self-remove
      wrapper = (...args) => {
        // 特殊モードが有効の場合は全イベント名から削除、無効の場合は現在のイベント名からのみ削除
        if (this.options.shareOnceListeners) {
          // 特別モード: すべてのイベント名から既存のリスナーを削除
          if (wrapper._eventNames) {
            const eventNames = [...wrapper._eventNames];
            eventNames.forEach(name => {
              this.off(name, wrapper);
            });
          }

          // Clean up our tracker
          this._onceTracker.delete(callback);
        } else {
          // 標準モード: 呼び出されたイベント名からのみ削除
          if (this._currentEventName) {
            this.off(this._currentEventName, wrapper);
            // イベント名をトラッキングセットから削除
            if (wrapper._eventNames) {
              wrapper._eventNames.delete(this._currentEventName);
            }

            // 登録されたイベントがすべて削除された場合はトラッカーからも削除
            if (wrapper._eventNames && wrapper._eventNames.size === 0) {
              this._onceTracker.delete(callback);
            }
          }
        }

        // Now actually call the original callback
        return callback.apply(this, args);
      };

      // Store the original callback for comparison
      wrapper._originalCallback = callback;

      // Track event names this wrapper is registered for
      wrapper._eventNames = new Set([eventName]);

      // Store in our tracker
      this._onceTracker.set(callback, wrapper);
    }

    // If we're currently emitting, queue the addition
    if (this._emitting) {
      this._pendingAdditions.push({
        eventName,
        callback: wrapper,
        priority,
        once: true
      });
      return this;
    }

    // Get or create the listeners array for this event
    if (!this.listeners.has(eventName)) {
      this.listeners.set(eventName, []);
    }
    const listeners = this.listeners.get(eventName);

    // Check for duplicate listener
    const existingIndex = listeners.findIndex(listener => listener.callback === wrapper);
    if (existingIndex !== -1) {
      // Update the existing listener's priority
      listeners[existingIndex].priority = priority;
    } else {
      // Add the new listener with the wrapper as callback
      listeners.push({
        callback: wrapper,
        once: true,
        priority
      });

      // Sort listeners by priority (highest first)
      listeners.sort((a, b) => b.priority - a.priority);
    }
    return this;
  }

  /**
   * Remove an event listener
   * @param {string} eventName - Name of the event to remove listener from
   * @param {Function} [callback] - Specific callback to remove (if omitted, all listeners for the event are removed)
   * @return {EventSystem} - Returns this instance for chaining
   */
  off(eventName, callback = null) {
    // If we're currently emitting, queue the removal
    if (this._emitting) {
      this._pendingRemovals.push({
        eventName,
        callback
      });
      return this;
    }

    // If eventName doesn't exist, nothing to do
    if (!this.listeners.has(eventName)) {
      return this;
    }

    // If callback is null, remove all listeners for this event
    if (callback === null) {
      this.listeners.delete(eventName);
      return this;
    }

    // Otherwise, only remove the specific callback
    const listeners = this.listeners.get(eventName);
    const filteredListeners = listeners.filter(listener => listener.callback !== callback);
    if (filteredListeners.length === 0) {
      // If no listeners remain, remove the event entirely
      this.listeners.delete(eventName);
    } else {
      // Otherwise, update the listeners array
      this.listeners.set(eventName, filteredListeners);
    }
    return this;
  }

  /**
   * Emit an event to all registered listeners
   * @param {string} eventName - Name of the event to emit
   * @param {*} [data] - Data to pass to the listeners
   * @return {boolean} - True if the event had listeners, false otherwise
   */
  emit(eventName, data) {
    // Mark that we're emitting an event
    const wasEmitting = this._emitting;
    this._emitting = true;

    // 最外部の emit 呼び出しでは invokedCallbacks をリセット
    if (!wasEmitting) {
      this._invokedCallbacks = new Set();
    }

    // Track whether any listeners were called
    let listenersCalled = false;
    try {
      // Add to history if debug mode is enabled
      if (this.options.debugMode) {
        this._addToHistory(eventName, data);
      }

      // Get all event names to emit based on the options
      const eventNamesToEmit = this._getEventNamesForEmission(eventName);

      // リスナーを削除するためのリスト
      const listenersToRemove = [];

      // Emit to each matched event name
      for (const name of eventNamesToEmit) {
        if (this.listeners.has(name)) {
          // リスナーのリストをコピーして処理（途中で削除される可能性があるため）
          const listeners = [...this.listeners.get(name)];

          // Call each listener
          for (const listener of listeners) {
            const {
              callback,
              once
            } = listener;

            // shareOnceListeners が有効な場合、onceリスナーとして登録された
            // 元のコールバックを追跡する
            const originalCallback = callback._originalCallback;

            // shareOnceListeners モード時、すでに呼び出されたコールバックはスキップ
            if (this.options.shareOnceListeners && originalCallback && this._invokedCallbacks.has(originalCallback)) {
              // 実行済みのコールバックのリスナーはリストから除去
              if (once) {
                listenersToRemove.push({
                  name,
                  callback
                });
              }
              continue;
            }
            try {
              // 現在のイベント名を設定（onceリスナーが自分自身を削除するために必要）
              const previousEventName = this._currentEventName;
              this._currentEventName = name;

              // Call the listener with the event data
              callback(data);
              listenersCalled = true;

              // originalCallback があれば呼び出し済みとしてマーク
              if (originalCallback) {
                this._invokedCallbacks.add(originalCallback);
              }

              // イベント名を元に戻す
              this._currentEventName = previousEventName;

              // If it's a once listener, mark it for removal
              // Note: The wrapper should have auto-removed itself already
              // This is just a safety net
              if (once) {
                listenersToRemove.push({
                  name,
                  callback
                });
              }
            } catch (error) {
              // Log the error but continue with other listeners
              console.error(`Error in event listener for '${name}':`, error);
            }
          }
        }
      }

      // 全てのリスナー実行後に、一度だけ削除処理を行う
      // これは主にセーフティネットとして機能します
      for (const {
        name,
        callback
      } of listenersToRemove) {
        // リスナーを削除
        if (this.listeners.has(name)) {
          const listeners = this.listeners.get(name);
          const updatedListeners = listeners.filter(l => l.callback !== callback);
          if (updatedListeners.length === 0) {
            this.listeners.delete(name);
          } else {
            this.listeners.set(name, updatedListeners);
          }
        }
      }

      // Process pending additions and removals (if we're not in a nested emit)
      if (!wasEmitting) {
        this._processPendingOperations();
      }
      return listenersCalled;
    } finally {
      // 最外部の emit 呼び出しが終了したら emitting フラグをリセット
      if (!wasEmitting) {
        this._emitting = false;
      }
    }
  }

  /**
   * Check if an event has any listeners
   * @param {string} eventName - Name of the event to check
   * @return {boolean} - True if the event has listeners, false otherwise
   */
  hasListeners(eventName) {
    // Direct match
    if (this.listeners.has(eventName) && this.listeners.get(eventName).length > 0) {
      return true;
    }

    // If wildcards are enabled, check for wildcard matches
    if (this.options.enableWildcards) {
      // 最適化: 最大チェック数を制限
      let checked = 0;
      const maxToCheck = 100;
      for (const [name, listeners] of this.listeners.entries()) {
        if (++checked > maxToCheck) break;
        if (listeners.length > 0 && name.includes('*') && this._matchesWildcard(name, eventName)) {
          return true;
        }
      }
    }
    return false;
  }

  /**
   * Get the number of listeners for an event
   * @param {string} eventName - Name of the event to check
   * @return {number} - Number of listeners for the event
   */
  listenerCount(eventName) {
    let count = 0;

    // Direct match
    if (this.listeners.has(eventName)) {
      count += this.listeners.get(eventName).length;
    }

    // If wildcards are enabled, check for wildcard matches
    if (this.options.enableWildcards) {
      // 最適化: 最大チェック数を制限
      let checked = 0;
      const maxToCheck = 100;
      for (const [name, listeners] of this.listeners.entries()) {
        if (++checked > maxToCheck) break;
        if (name !== eventName && name.includes('*') && this._matchesWildcard(name, eventName)) {
          count += listeners.length;
        }
      }
    }
    return count;
  }

  /**
   * Get all registered event names
   * @return {string[]} - Array of registered event names
   */
  eventNames() {
    return Array.from(this.listeners.keys());
  }

  /**
   * Get the recent event history (only available in debug mode)
   * @param {number} [limit=10] - Maximum number of events to return
   * @return {Array} - Array of recent events or empty array if debug mode is disabled
   */
  getEventHistory(limit = 10) {
    if (!this.options.debugMode) {
      return [];
    }
    const actualLimit = Math.min(limit, this.eventHistory.length);
    return this.eventHistory.slice(-actualLimit);
  }

  /**
   * Clear all event listeners
   * @return {EventSystem} - Returns this instance for chaining
   */
  removeAllListeners() {
    this.listeners.clear();
    return this;
  }

  /**
   * Process pending listener additions and removals
   * @private
   */
  _processPendingOperations() {
    // 最適化: 大量のペンディング操作がある場合のガード
    const maxOperations = 1000;

    // Process removals first to avoid issues with additions that would be immediately removed
    const removalsToProcess = Math.min(this._pendingRemovals.length, maxOperations);
    for (let i = 0; i < removalsToProcess; i++) {
      const {
        eventName,
        callback
      } = this._pendingRemovals[i];
      this.off(eventName, callback);
    }

    // 処理した分だけ配列から削除
    if (removalsToProcess === this._pendingRemovals.length) {
      this._pendingRemovals = [];
    } else {
      this._pendingRemovals = this._pendingRemovals.slice(removalsToProcess);
    }

    // Then process additions
    const additionsToProcess = Math.min(this._pendingAdditions.length, maxOperations);
    for (let i = 0; i < additionsToProcess; i++) {
      const {
        eventName,
        callback,
        priority,
        once
      } = this._pendingAdditions[i];
      if (once) {
        this.once(eventName, callback, priority);
      } else {
        this.on(eventName, callback, priority);
      }
    }

    // 処理した分だけ配列から削除
    if (additionsToProcess === this._pendingAdditions.length) {
      this._pendingAdditions = [];
    } else {
      this._pendingAdditions = this._pendingAdditions.slice(additionsToProcess);
    }
  }

  /**
   * Add an event to the history
   * @param {string} eventName - Name of the emitted event
   * @param {*} data - Data passed with the event
   * @private
   */
  _addToHistory(eventName, data) {
    // Add to history with timestamp
    this.eventHistory.push({
      eventName,
      data,
      timestamp: new Date()
    });

    // Trim history if it exceeds the limit
    if (this.eventHistory.length > this.options.historyLimit) {
      this.eventHistory.shift();
    }
  }

  /**
   * Get all event names to emit based on the original event and options
   * @param {string} eventName - The original event name
   * @return {string[]} - Array of event names to emit
   * @private
   */
  _getEventNamesForEmission(eventName) {
    const eventNames = [eventName];

    // Add namespace parent events if enabled
    if (this.options.enableNamespaces && eventName.includes('.')) {
      const parts = eventName.split('.');
      // 最適化: 一度に全部を計算せず徐々に親名前空間を構築
      let parentName = '';
      for (let i = 0; i < parts.length - 1; i++) {
        parentName = parentName ? `${parentName}.${parts[i]}` : parts[i];
        eventNames.push(parentName);
      }
    }

    // 最適化: ワイルドカードが有効な場合は、必要なリスナーのみマッチングする
    if (this.options.enableWildcards) {
      // 最適化: リスナーの数が多すぎる場合は制限する
      const maxListenersToCheck = 100;
      let checkedCount = 0;
      for (const name of this.listeners.keys()) {
        // ワイルドカード文字を含む場合のみチェック
        if (!name.includes('*')) continue;

        // 処理済みのイベント名はスキップ
        if (eventNames.includes(name)) continue;

        // 最大制限に達したら停止
        if (++checkedCount > maxListenersToCheck) {
          break;
        }

        // ワイルドカードパターンの簡易チェック
        if (this._matchesWildcard(name, eventName)) {
          eventNames.push(name);
        }
      }
    }
    return eventNames;
  }

  /**
   * Check if a wildcard pattern matches an event name
   * @param {string} pattern - The wildcard pattern to check
   * @param {string} eventName - The event name to match against
   * @return {boolean} - True if the pattern matches the event name
   * @private
   */
  _matchesWildcard(pattern, eventName) {
    // パターンや名前が異常に長い場合はマッチングを諦める（安全対策）
    if (pattern.length > 1000 || eventName.length > 1000) {
      return false;
    }

    // 単純なチェック
    if (pattern === eventName) {
      return true;
    }

    // 単純なワイルドカードチェック
    if (pattern === '*') {
      return !eventName.includes('.');
    }
    if (pattern === '**') {
      return true;
    }

    // 複数階層のワイルドカード (**) の処理
    if (pattern.includes('**')) {
      const parts = pattern.split('**');

      // 最適化: 最大2つのパートのみをサポート
      if (parts.length > 2) {
        return false;
      }

      // パターンが 'game.**' のような形式の場合
      if (parts.length === 2 && parts[1] === '') {
        return eventName.startsWith(parts[0]);
      }

      // パターンが '**.end' のような形式の場合
      if (parts.length === 2 && parts[0] === '') {
        return eventName.endsWith(parts[1]);
      }

      // パターンが 'start.**.end' のような形式の場合
      if (parts.length === 2) {
        return eventName.startsWith(parts[0]) && eventName.endsWith(parts[1]);
      }
    }

    // 単一階層のワイルドカード (*) の処理
    if (pattern.includes('*') && !pattern.includes('**')) {
      // 正規表現を使わない最適化された方法
      const patternParts = pattern.split('.');
      const eventParts = eventName.split('.');
      if (patternParts.length !== eventParts.length) {
        return false;
      }
      for (let i = 0; i < patternParts.length; i++) {
        if (patternParts[i] === '*') {
          continue; // ワイルドカードは何にもマッチする
        }
        if (patternParts[i] !== eventParts[i]) {
          return false;
        }
      }
      return true;
    }
    return false;
  }
}
module.exports = EventSystem;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJFdmVudFN5c3RlbSIsImNvbnN0cnVjdG9yIiwib3B0aW9ucyIsImVuYWJsZU5hbWVzcGFjZXMiLCJkZWJ1Z01vZGUiLCJlbmFibGVXaWxkY2FyZHMiLCJoaXN0b3J5TGltaXQiLCJzaGFyZU9uY2VMaXN0ZW5lcnMiLCJsaXN0ZW5lcnMiLCJNYXAiLCJldmVudEhpc3RvcnkiLCJfZW1pdHRpbmciLCJfcGVuZGluZ0FkZGl0aW9ucyIsIl9wZW5kaW5nUmVtb3ZhbHMiLCJfaW52b2tlZENhbGxiYWNrcyIsIlNldCIsIm9uIiwiZXZlbnROYW1lIiwiY2FsbGJhY2siLCJwcmlvcml0eSIsInRyaW0iLCJFcnJvciIsInB1c2giLCJvbmNlIiwiaGFzIiwic2V0IiwiZ2V0IiwiZXhpc3RpbmdJbmRleCIsImZpbmRJbmRleCIsImxpc3RlbmVyIiwic29ydCIsImEiLCJiIiwiX29uY2VUcmFja2VyIiwid3JhcHBlciIsIl9ldmVudE5hbWVzIiwiYWRkIiwiYXJncyIsImV2ZW50TmFtZXMiLCJmb3JFYWNoIiwibmFtZSIsIm9mZiIsImRlbGV0ZSIsIl9jdXJyZW50RXZlbnROYW1lIiwic2l6ZSIsImFwcGx5IiwiX29yaWdpbmFsQ2FsbGJhY2siLCJmaWx0ZXJlZExpc3RlbmVycyIsImZpbHRlciIsImxlbmd0aCIsImVtaXQiLCJkYXRhIiwid2FzRW1pdHRpbmciLCJsaXN0ZW5lcnNDYWxsZWQiLCJfYWRkVG9IaXN0b3J5IiwiZXZlbnROYW1lc1RvRW1pdCIsIl9nZXRFdmVudE5hbWVzRm9yRW1pc3Npb24iLCJsaXN0ZW5lcnNUb1JlbW92ZSIsIm9yaWdpbmFsQ2FsbGJhY2siLCJwcmV2aW91c0V2ZW50TmFtZSIsImVycm9yIiwiY29uc29sZSIsInVwZGF0ZWRMaXN0ZW5lcnMiLCJsIiwiX3Byb2Nlc3NQZW5kaW5nT3BlcmF0aW9ucyIsImhhc0xpc3RlbmVycyIsImNoZWNrZWQiLCJtYXhUb0NoZWNrIiwiZW50cmllcyIsImluY2x1ZGVzIiwiX21hdGNoZXNXaWxkY2FyZCIsImxpc3RlbmVyQ291bnQiLCJjb3VudCIsIkFycmF5IiwiZnJvbSIsImtleXMiLCJnZXRFdmVudEhpc3RvcnkiLCJsaW1pdCIsImFjdHVhbExpbWl0IiwiTWF0aCIsIm1pbiIsInNsaWNlIiwicmVtb3ZlQWxsTGlzdGVuZXJzIiwiY2xlYXIiLCJtYXhPcGVyYXRpb25zIiwicmVtb3ZhbHNUb1Byb2Nlc3MiLCJpIiwiYWRkaXRpb25zVG9Qcm9jZXNzIiwidGltZXN0YW1wIiwiRGF0ZSIsInNoaWZ0IiwicGFydHMiLCJzcGxpdCIsInBhcmVudE5hbWUiLCJtYXhMaXN0ZW5lcnNUb0NoZWNrIiwiY2hlY2tlZENvdW50IiwicGF0dGVybiIsInN0YXJ0c1dpdGgiLCJlbmRzV2l0aCIsInBhdHRlcm5QYXJ0cyIsImV2ZW50UGFydHMiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiRXZlbnRTeXN0ZW0uanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBFdmVudFN5c3RlbSAtIENvcmUgZXZlbnQgbWFuYWdlbWVudCBtb2R1bGUgZm9yIHRoZSB3ZXJld29sZiBnYW1lIEdNIHN1cHBvcnQgbGlicmFyeVxuICpcbiAqIFRoaXMgbW9kdWxlIHByb3ZpZGVzIHRoZSBmb3VuZGF0aW9uIGZvciB0aGUgZXZlbnQtZHJpdmVuIGFyY2hpdGVjdHVyZSxcbiAqIGVuYWJsaW5nIGNvbW11bmljYXRpb24gYmV0d2VlbiBkaWZmZXJlbnQgbW9kdWxlcyB0aHJvdWdoIGV2ZW50cy5cbiAqL1xuXG5jbGFzcyBFdmVudFN5c3RlbSB7XG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgbmV3IEV2ZW50U3lzdGVtIGluc3RhbmNlXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIC0gQ29uZmlndXJhdGlvbiBvcHRpb25zXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gW29wdGlvbnMuZW5hYmxlTmFtZXNwYWNlcz10cnVlXSAtIEVuYWJsZSBoaWVyYXJjaGljYWwgZXZlbnQgbmFtZXNwYWNlc1xuICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtvcHRpb25zLmRlYnVnTW9kZT1mYWxzZV0gLSBFbmFibGUgZGVidWcgbW9kZSB3aXRoIGV2ZW50IGhpc3RvcnlcbiAgICogQHBhcmFtIHtib29sZWFufSBbb3B0aW9ucy5lbmFibGVXaWxkY2FyZHM9ZmFsc2VdIC0gRW5hYmxlIHdpbGRjYXJkIGV2ZW50IG1hdGNoaW5nXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0aW9ucy5oaXN0b3J5TGltaXQ9MTAwXSAtIE1heGltdW0gbnVtYmVyIG9mIGV2ZW50cyB0byBrZWVwIGluIGhpc3RvcnlcbiAgICogQHBhcmFtIHtib29sZWFufSBbb3B0aW9ucy5zaGFyZU9uY2VMaXN0ZW5lcnM9ZmFsc2VdIC0gV2hldGhlciBvbmNlIGxpc3RlbmVycyBzaG91bGQgYmUgc2hhcmVkIGFjcm9zcyBldmVudCBuYW1lc1xuICAgKi9cbiAgY29uc3RydWN0b3Iob3B0aW9ucyA9IHt9KSB7XG4gICAgLy8gRGVmYXVsdCBvcHRpb25zXG4gICAgdGhpcy5vcHRpb25zID0ge1xuICAgICAgZW5hYmxlTmFtZXNwYWNlczogdHJ1ZSxcbiAgICAgIGRlYnVnTW9kZTogZmFsc2UsXG4gICAgICBlbmFibGVXaWxkY2FyZHM6IGZhbHNlLCBcbiAgICAgIGhpc3RvcnlMaW1pdDogMTAwLFxuICAgICAgc2hhcmVPbmNlTGlzdGVuZXJzOiBmYWxzZSxcbiAgICAgIC4uLm9wdGlvbnNcbiAgICB9O1xuXG4gICAgLy8gTWFwIHRvIHN0b3JlIGV2ZW50IGxpc3RlbmVyczogeyBldmVudE5hbWUgPT4gW3sgY2FsbGJhY2ssIG9uY2UsIHByaW9yaXR5IH1dIH1cbiAgICB0aGlzLmxpc3RlbmVycyA9IG5ldyBNYXAoKTtcblxuICAgIC8vIEV2ZW50IGhpc3RvcnkgZm9yIGRlYnVnZ2luZyAob25seSBhY3RpdmUgaW4gZGVidWcgbW9kZSlcbiAgICB0aGlzLmV2ZW50SGlzdG9yeSA9IFtdO1xuXG4gICAgLy8gRmxhZyB0byB0cmFjayBpZiB3ZSdyZSBjdXJyZW50bHkgZW1pdHRpbmcgYW4gZXZlbnQgKHRvIGhhbmRsZSBuZXN0ZWQgZW1pc3Npb25zKVxuICAgIHRoaXMuX2VtaXR0aW5nID0gZmFsc2U7XG5cbiAgICAvLyBRdWV1ZSBmb3IgbGlzdGVuZXJzIHRvIGJlIGFkZGVkL3JlbW92ZWQgZHVyaW5nIGVtaXNzaW9uXG4gICAgdGhpcy5fcGVuZGluZ0FkZGl0aW9ucyA9IFtdO1xuICAgIHRoaXMuX3BlbmRpbmdSZW1vdmFscyA9IFtdO1xuICAgIFxuICAgIC8vIFNldCB0byB0cmFjayB3aGljaCBjYWxsYmFja3MgaGF2ZSBiZWVuIGludm9rZWQgZHVyaW5nIGFuIGVtaXNzaW9uIGN5Y2xlXG4gICAgdGhpcy5faW52b2tlZENhbGxiYWNrcyA9IG5ldyBTZXQoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWdpc3RlciBhbiBldmVudCBsaXN0ZW5lclxuICAgKiBAcGFyYW0ge3N0cmluZ30gZXZlbnROYW1lIC0gTmFtZSBvZiB0aGUgZXZlbnQgdG8gbGlzdGVuIGZvclxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayAtIEZ1bmN0aW9uIHRvIGNhbGwgd2hlbiB0aGUgZXZlbnQgaXMgZW1pdHRlZFxuICAgKiBAcGFyYW0ge251bWJlcn0gW3ByaW9yaXR5PTBdIC0gUHJpb3JpdHkgb2YgdGhlIGxpc3RlbmVyIChoaWdoZXIgZXhlY3V0ZXMgZmlyc3QpXG4gICAqIEByZXR1cm4ge0V2ZW50U3lzdGVtfSAtIFJldHVybnMgdGhpcyBpbnN0YW5jZSBmb3IgY2hhaW5pbmdcbiAgICogQHRocm93cyB7RXJyb3J9IElmIGV2ZW50TmFtZSBpcyBub3QgYSBzdHJpbmcgb3IgY2FsbGJhY2sgaXMgbm90IGEgZnVuY3Rpb25cbiAgICovXG4gIG9uKGV2ZW50TmFtZSwgY2FsbGJhY2ssIHByaW9yaXR5ID0gMCkge1xuICAgIC8vIFZhbGlkYXRlIGFyZ3VtZW50c1xuICAgIGlmICh0eXBlb2YgZXZlbnROYW1lICE9PSAnc3RyaW5nJyB8fCBldmVudE5hbWUudHJpbSgpID09PSAnJykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdFdmVudCBuYW1lIG11c3QgYmUgYSBub24tZW1wdHkgc3RyaW5nJyk7XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiBjYWxsYmFjayAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYWxsYmFjayBtdXN0IGJlIGEgZnVuY3Rpb24nKTtcbiAgICB9XG5cbiAgICAvLyBJZiB3ZSdyZSBjdXJyZW50bHkgZW1pdHRpbmcsIHF1ZXVlIHRoZSBhZGRpdGlvblxuICAgIGlmICh0aGlzLl9lbWl0dGluZykge1xuICAgICAgdGhpcy5fcGVuZGluZ0FkZGl0aW9ucy5wdXNoKHsgZXZlbnROYW1lLCBjYWxsYmFjaywgcHJpb3JpdHksIG9uY2U6IGZhbHNlIH0pO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgLy8gR2V0IG9yIGNyZWF0ZSB0aGUgbGlzdGVuZXJzIGFycmF5IGZvciB0aGlzIGV2ZW50XG4gICAgaWYgKCF0aGlzLmxpc3RlbmVycy5oYXMoZXZlbnROYW1lKSkge1xuICAgICAgdGhpcy5saXN0ZW5lcnMuc2V0KGV2ZW50TmFtZSwgW10pO1xuICAgIH1cblxuICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMubGlzdGVuZXJzLmdldChldmVudE5hbWUpO1xuXG4gICAgLy8gQ2hlY2sgZm9yIGR1cGxpY2F0ZSBsaXN0ZW5lclxuICAgIGNvbnN0IGV4aXN0aW5nSW5kZXggPSBsaXN0ZW5lcnMuZmluZEluZGV4KGxpc3RlbmVyID0+IGxpc3RlbmVyLmNhbGxiYWNrID09PSBjYWxsYmFjayk7XG4gICAgaWYgKGV4aXN0aW5nSW5kZXggIT09IC0xKSB7XG4gICAgICAvLyBVcGRhdGUgdGhlIGV4aXN0aW5nIGxpc3RlbmVyJ3MgcHJpb3JpdHlcbiAgICAgIGxpc3RlbmVyc1tleGlzdGluZ0luZGV4XS5wcmlvcml0eSA9IHByaW9yaXR5O1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBBZGQgdGhlIG5ldyBsaXN0ZW5lclxuICAgICAgbGlzdGVuZXJzLnB1c2goeyBjYWxsYmFjaywgb25jZTogZmFsc2UsIHByaW9yaXR5IH0pO1xuXG4gICAgICAvLyBTb3J0IGxpc3RlbmVycyBieSBwcmlvcml0eSAoaGlnaGVzdCBmaXJzdClcbiAgICAgIGxpc3RlbmVycy5zb3J0KChhLCBiKSA9PiBiLnByaW9yaXR5IC0gYS5wcmlvcml0eSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogUmVnaXN0ZXIgYSBvbmUtdGltZSBldmVudCBsaXN0ZW5lciB0aGF0IHdpbGwgYmUgcmVtb3ZlZCBhZnRlciBleGVjdXRpb25cbiAgICogQHBhcmFtIHtzdHJpbmd9IGV2ZW50TmFtZSAtIE5hbWUgb2YgdGhlIGV2ZW50IHRvIGxpc3RlbiBmb3JcbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgLSBGdW5jdGlvbiB0byBjYWxsIHdoZW4gdGhlIGV2ZW50IGlzIGVtaXR0ZWRcbiAgICogQHBhcmFtIHtudW1iZXJ9IFtwcmlvcml0eT0wXSAtIFByaW9yaXR5IG9mIHRoZSBsaXN0ZW5lciAoaGlnaGVyIGV4ZWN1dGVzIGZpcnN0KVxuICAgKiBAcmV0dXJuIHtFdmVudFN5c3RlbX0gLSBSZXR1cm5zIHRoaXMgaW5zdGFuY2UgZm9yIGNoYWluaW5nXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBJZiBldmVudE5hbWUgaXMgbm90IGEgc3RyaW5nIG9yIGNhbGxiYWNrIGlzIG5vdCBhIGZ1bmN0aW9uXG4gICAqL1xuICBvbmNlKGV2ZW50TmFtZSwgY2FsbGJhY2ssIHByaW9yaXR5ID0gMCkge1xuICAgIC8vIFZhbGlkYXRlIGFyZ3VtZW50c1xuICAgIGlmICh0eXBlb2YgZXZlbnROYW1lICE9PSAnc3RyaW5nJyB8fCBldmVudE5hbWUudHJpbSgpID09PSAnJykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdFdmVudCBuYW1lIG11c3QgYmUgYSBub24tZW1wdHkgc3RyaW5nJyk7XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiBjYWxsYmFjayAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYWxsYmFjayBtdXN0IGJlIGEgZnVuY3Rpb24nKTtcbiAgICB9XG4gICAgXG4gICAgLy8gVHJhY2tlZCBjYWxsYmFja3MgZm9yIG9uY2UgLSBnbG9iYWwgdG8gaW5zdGFuY2VcbiAgICBpZiAoIXRoaXMuX29uY2VUcmFja2VyKSB7XG4gICAgICB0aGlzLl9vbmNlVHJhY2tlciA9IG5ldyBNYXAoKTtcbiAgICB9XG4gICAgXG4gICAgLy8gRWFjaCBvcmlnaW5hbCBjYWxsYmFjayBnZXRzIGl0cyBvd24gd3JhcHBlclxuICAgIGxldCB3cmFwcGVyO1xuICAgIFxuICAgIC8vIENoZWNrIGlmIHdlIGFscmVhZHkgaGF2ZSBhIHdyYXBwZXIgZm9yIHRoaXMgY2FsbGJhY2tcbiAgICBpZiAodGhpcy5fb25jZVRyYWNrZXIuaGFzKGNhbGxiYWNrKSkge1xuICAgICAgd3JhcHBlciA9IHRoaXMuX29uY2VUcmFja2VyLmdldChjYWxsYmFjayk7XG4gICAgICBcbiAgICAgIC8vIEFkZCB0aGlzIGV2ZW50IG5hbWUgdG8gdGhlIHdyYXBwZXIncyB0cmFja2VkIGV2ZW50c1xuICAgICAgaWYgKCF3cmFwcGVyLl9ldmVudE5hbWVzKSB7XG4gICAgICAgIHdyYXBwZXIuX2V2ZW50TmFtZXMgPSBuZXcgU2V0KCk7XG4gICAgICB9XG4gICAgICB3cmFwcGVyLl9ldmVudE5hbWVzLmFkZChldmVudE5hbWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBDcmVhdGUgYSBzcGVjaWFsIGJvdW5kIHZlcnNpb24gdGhhdCB3aWxsIHNlbGYtcmVtb3ZlXG4gICAgICB3cmFwcGVyID0gKC4uLmFyZ3MpID0+IHtcbiAgICAgICAgLy8g54m55q6K44Oi44O844OJ44GM5pyJ5Yq544Gu5aC05ZCI44Gv5YWo44Kk44OZ44Oz44OI5ZCN44GL44KJ5YmK6Zmk44CB54Sh5Yq544Gu5aC05ZCI44Gv54++5Zyo44Gu44Kk44OZ44Oz44OI5ZCN44GL44KJ44Gu44G/5YmK6ZmkXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc2hhcmVPbmNlTGlzdGVuZXJzKSB7XG4gICAgICAgICAgLy8g54m55Yil44Oi44O844OJOiDjgZnjgbnjgabjga7jgqTjg5njg7Pjg4jlkI3jgYvjgonml6LlrZjjga7jg6rjgrnjg4rjg7zjgpLliYrpmaRcbiAgICAgICAgICBpZiAod3JhcHBlci5fZXZlbnROYW1lcykge1xuICAgICAgICAgICAgY29uc3QgZXZlbnROYW1lcyA9IFsuLi53cmFwcGVyLl9ldmVudE5hbWVzXTtcbiAgICAgICAgICAgIGV2ZW50TmFtZXMuZm9yRWFjaChuYW1lID0+IHtcbiAgICAgICAgICAgICAgdGhpcy5vZmYobmFtZSwgd3JhcHBlcik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gQ2xlYW4gdXAgb3VyIHRyYWNrZXJcbiAgICAgICAgICB0aGlzLl9vbmNlVHJhY2tlci5kZWxldGUoY2FsbGJhY2spO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIOaomea6luODouODvOODiTog5ZG844Gz5Ye644GV44KM44Gf44Kk44OZ44Oz44OI5ZCN44GL44KJ44Gu44G/5YmK6ZmkXG4gICAgICAgICAgaWYgKHRoaXMuX2N1cnJlbnRFdmVudE5hbWUpIHtcbiAgICAgICAgICAgIHRoaXMub2ZmKHRoaXMuX2N1cnJlbnRFdmVudE5hbWUsIHdyYXBwZXIpO1xuICAgICAgICAgICAgLy8g44Kk44OZ44Oz44OI5ZCN44KS44OI44Op44OD44Kt44Oz44Kw44K744OD44OI44GL44KJ5YmK6ZmkXG4gICAgICAgICAgICBpZiAod3JhcHBlci5fZXZlbnROYW1lcykge1xuICAgICAgICAgICAgICB3cmFwcGVyLl9ldmVudE5hbWVzLmRlbGV0ZSh0aGlzLl9jdXJyZW50RXZlbnROYW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8g55m76Yyy44GV44KM44Gf44Kk44OZ44Oz44OI44GM44GZ44G544Gm5YmK6Zmk44GV44KM44Gf5aC05ZCI44Gv44OI44Op44OD44Kr44O844GL44KJ44KC5YmK6ZmkXG4gICAgICAgICAgICBpZiAod3JhcHBlci5fZXZlbnROYW1lcyAmJiB3cmFwcGVyLl9ldmVudE5hbWVzLnNpemUgPT09IDApIHtcbiAgICAgICAgICAgICAgdGhpcy5fb25jZVRyYWNrZXIuZGVsZXRlKGNhbGxiYWNrKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIE5vdyBhY3R1YWxseSBjYWxsIHRoZSBvcmlnaW5hbCBjYWxsYmFja1xuICAgICAgICByZXR1cm4gY2FsbGJhY2suYXBwbHkodGhpcywgYXJncyk7XG4gICAgICB9O1xuICAgICAgXG4gICAgICAvLyBTdG9yZSB0aGUgb3JpZ2luYWwgY2FsbGJhY2sgZm9yIGNvbXBhcmlzb25cbiAgICAgIHdyYXBwZXIuX29yaWdpbmFsQ2FsbGJhY2sgPSBjYWxsYmFjaztcbiAgICAgIFxuICAgICAgLy8gVHJhY2sgZXZlbnQgbmFtZXMgdGhpcyB3cmFwcGVyIGlzIHJlZ2lzdGVyZWQgZm9yXG4gICAgICB3cmFwcGVyLl9ldmVudE5hbWVzID0gbmV3IFNldChbZXZlbnROYW1lXSk7XG4gICAgICBcbiAgICAgIC8vIFN0b3JlIGluIG91ciB0cmFja2VyXG4gICAgICB0aGlzLl9vbmNlVHJhY2tlci5zZXQoY2FsbGJhY2ssIHdyYXBwZXIpO1xuICAgIH1cblxuICAgIC8vIElmIHdlJ3JlIGN1cnJlbnRseSBlbWl0dGluZywgcXVldWUgdGhlIGFkZGl0aW9uXG4gICAgaWYgKHRoaXMuX2VtaXR0aW5nKSB7XG4gICAgICB0aGlzLl9wZW5kaW5nQWRkaXRpb25zLnB1c2goeyBldmVudE5hbWUsIGNhbGxiYWNrOiB3cmFwcGVyLCBwcmlvcml0eSwgb25jZTogdHJ1ZSB9KTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8vIEdldCBvciBjcmVhdGUgdGhlIGxpc3RlbmVycyBhcnJheSBmb3IgdGhpcyBldmVudFxuICAgIGlmICghdGhpcy5saXN0ZW5lcnMuaGFzKGV2ZW50TmFtZSkpIHtcbiAgICAgIHRoaXMubGlzdGVuZXJzLnNldChldmVudE5hbWUsIFtdKTtcbiAgICB9XG5cbiAgICBjb25zdCBsaXN0ZW5lcnMgPSB0aGlzLmxpc3RlbmVycy5nZXQoZXZlbnROYW1lKTtcblxuICAgIC8vIENoZWNrIGZvciBkdXBsaWNhdGUgbGlzdGVuZXJcbiAgICBjb25zdCBleGlzdGluZ0luZGV4ID0gbGlzdGVuZXJzLmZpbmRJbmRleChsaXN0ZW5lciA9PiBsaXN0ZW5lci5jYWxsYmFjayA9PT0gd3JhcHBlcik7XG4gICAgaWYgKGV4aXN0aW5nSW5kZXggIT09IC0xKSB7XG4gICAgICAvLyBVcGRhdGUgdGhlIGV4aXN0aW5nIGxpc3RlbmVyJ3MgcHJpb3JpdHlcbiAgICAgIGxpc3RlbmVyc1tleGlzdGluZ0luZGV4XS5wcmlvcml0eSA9IHByaW9yaXR5O1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBBZGQgdGhlIG5ldyBsaXN0ZW5lciB3aXRoIHRoZSB3cmFwcGVyIGFzIGNhbGxiYWNrXG4gICAgICBsaXN0ZW5lcnMucHVzaCh7IGNhbGxiYWNrOiB3cmFwcGVyLCBvbmNlOiB0cnVlLCBwcmlvcml0eSB9KTtcblxuICAgICAgLy8gU29ydCBsaXN0ZW5lcnMgYnkgcHJpb3JpdHkgKGhpZ2hlc3QgZmlyc3QpXG4gICAgICBsaXN0ZW5lcnMuc29ydCgoYSwgYikgPT4gYi5wcmlvcml0eSAtIGEucHJpb3JpdHkpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZSBhbiBldmVudCBsaXN0ZW5lclxuICAgKiBAcGFyYW0ge3N0cmluZ30gZXZlbnROYW1lIC0gTmFtZSBvZiB0aGUgZXZlbnQgdG8gcmVtb3ZlIGxpc3RlbmVyIGZyb21cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NhbGxiYWNrXSAtIFNwZWNpZmljIGNhbGxiYWNrIHRvIHJlbW92ZSAoaWYgb21pdHRlZCwgYWxsIGxpc3RlbmVycyBmb3IgdGhlIGV2ZW50IGFyZSByZW1vdmVkKVxuICAgKiBAcmV0dXJuIHtFdmVudFN5c3RlbX0gLSBSZXR1cm5zIHRoaXMgaW5zdGFuY2UgZm9yIGNoYWluaW5nXG4gICAqL1xuICBvZmYoZXZlbnROYW1lLCBjYWxsYmFjayA9IG51bGwpIHtcbiAgICAvLyBJZiB3ZSdyZSBjdXJyZW50bHkgZW1pdHRpbmcsIHF1ZXVlIHRoZSByZW1vdmFsXG4gICAgaWYgKHRoaXMuX2VtaXR0aW5nKSB7XG4gICAgICB0aGlzLl9wZW5kaW5nUmVtb3ZhbHMucHVzaCh7IGV2ZW50TmFtZSwgY2FsbGJhY2sgfSk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICAvLyBJZiBldmVudE5hbWUgZG9lc24ndCBleGlzdCwgbm90aGluZyB0byBkb1xuICAgIGlmICghdGhpcy5saXN0ZW5lcnMuaGFzKGV2ZW50TmFtZSkpIHtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8vIElmIGNhbGxiYWNrIGlzIG51bGwsIHJlbW92ZSBhbGwgbGlzdGVuZXJzIGZvciB0aGlzIGV2ZW50XG4gICAgaWYgKGNhbGxiYWNrID09PSBudWxsKSB7XG4gICAgICB0aGlzLmxpc3RlbmVycy5kZWxldGUoZXZlbnROYW1lKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8vIE90aGVyd2lzZSwgb25seSByZW1vdmUgdGhlIHNwZWNpZmljIGNhbGxiYWNrXG4gICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5saXN0ZW5lcnMuZ2V0KGV2ZW50TmFtZSk7XG4gICAgY29uc3QgZmlsdGVyZWRMaXN0ZW5lcnMgPSBsaXN0ZW5lcnMuZmlsdGVyKGxpc3RlbmVyID0+IGxpc3RlbmVyLmNhbGxiYWNrICE9PSBjYWxsYmFjayk7XG5cbiAgICBpZiAoZmlsdGVyZWRMaXN0ZW5lcnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAvLyBJZiBubyBsaXN0ZW5lcnMgcmVtYWluLCByZW1vdmUgdGhlIGV2ZW50IGVudGlyZWx5XG4gICAgICB0aGlzLmxpc3RlbmVycy5kZWxldGUoZXZlbnROYW1lKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gT3RoZXJ3aXNlLCB1cGRhdGUgdGhlIGxpc3RlbmVycyBhcnJheVxuICAgICAgdGhpcy5saXN0ZW5lcnMuc2V0KGV2ZW50TmFtZSwgZmlsdGVyZWRMaXN0ZW5lcnMpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIEVtaXQgYW4gZXZlbnQgdG8gYWxsIHJlZ2lzdGVyZWQgbGlzdGVuZXJzXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBldmVudE5hbWUgLSBOYW1lIG9mIHRoZSBldmVudCB0byBlbWl0XG4gICAqIEBwYXJhbSB7Kn0gW2RhdGFdIC0gRGF0YSB0byBwYXNzIHRvIHRoZSBsaXN0ZW5lcnNcbiAgICogQHJldHVybiB7Ym9vbGVhbn0gLSBUcnVlIGlmIHRoZSBldmVudCBoYWQgbGlzdGVuZXJzLCBmYWxzZSBvdGhlcndpc2VcbiAgICovXG4gIGVtaXQoZXZlbnROYW1lLCBkYXRhKSB7XG4gICAgLy8gTWFyayB0aGF0IHdlJ3JlIGVtaXR0aW5nIGFuIGV2ZW50XG4gICAgY29uc3Qgd2FzRW1pdHRpbmcgPSB0aGlzLl9lbWl0dGluZztcbiAgICB0aGlzLl9lbWl0dGluZyA9IHRydWU7XG4gICAgXG4gICAgLy8g5pyA5aSW6YOo44GuIGVtaXQg5ZG844Gz5Ye644GX44Gn44GvIGludm9rZWRDYWxsYmFja3Mg44KS44Oq44K744OD44OIXG4gICAgaWYgKCF3YXNFbWl0dGluZykge1xuICAgICAgdGhpcy5faW52b2tlZENhbGxiYWNrcyA9IG5ldyBTZXQoKTtcbiAgICB9XG5cbiAgICAvLyBUcmFjayB3aGV0aGVyIGFueSBsaXN0ZW5lcnMgd2VyZSBjYWxsZWRcbiAgICBsZXQgbGlzdGVuZXJzQ2FsbGVkID0gZmFsc2U7XG5cbiAgICB0cnkge1xuICAgICAgLy8gQWRkIHRvIGhpc3RvcnkgaWYgZGVidWcgbW9kZSBpcyBlbmFibGVkXG4gICAgICBpZiAodGhpcy5vcHRpb25zLmRlYnVnTW9kZSkge1xuICAgICAgICB0aGlzLl9hZGRUb0hpc3RvcnkoZXZlbnROYW1lLCBkYXRhKTtcbiAgICAgIH1cblxuICAgICAgLy8gR2V0IGFsbCBldmVudCBuYW1lcyB0byBlbWl0IGJhc2VkIG9uIHRoZSBvcHRpb25zXG4gICAgICBjb25zdCBldmVudE5hbWVzVG9FbWl0ID0gdGhpcy5fZ2V0RXZlbnROYW1lc0ZvckVtaXNzaW9uKGV2ZW50TmFtZSk7XG4gICAgICBcbiAgICAgIC8vIOODquOCueODiuODvOOCkuWJiumZpOOBmeOCi+OBn+OCgeOBruODquOCueODiFxuICAgICAgY29uc3QgbGlzdGVuZXJzVG9SZW1vdmUgPSBbXTtcblxuICAgICAgLy8gRW1pdCB0byBlYWNoIG1hdGNoZWQgZXZlbnQgbmFtZVxuICAgICAgZm9yIChjb25zdCBuYW1lIG9mIGV2ZW50TmFtZXNUb0VtaXQpIHtcbiAgICAgICAgaWYgKHRoaXMubGlzdGVuZXJzLmhhcyhuYW1lKSkge1xuICAgICAgICAgIC8vIOODquOCueODiuODvOOBruODquOCueODiOOCkuOCs+ODlOODvOOBl+OBpuWHpueQhu+8iOmAlOS4reOBp+WJiumZpOOBleOCjOOCi+WPr+iDveaAp+OBjOOBguOCi+OBn+OCge+8iVxuICAgICAgICAgIGNvbnN0IGxpc3RlbmVycyA9IFsuLi50aGlzLmxpc3RlbmVycy5nZXQobmFtZSldO1xuXG4gICAgICAgICAgLy8gQ2FsbCBlYWNoIGxpc3RlbmVyXG4gICAgICAgICAgZm9yIChjb25zdCBsaXN0ZW5lciBvZiBsaXN0ZW5lcnMpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgY2FsbGJhY2ssIG9uY2UgfSA9IGxpc3RlbmVyO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBzaGFyZU9uY2VMaXN0ZW5lcnMg44GM5pyJ5Yq544Gq5aC05ZCI44CBb25jZeODquOCueODiuODvOOBqOOBl+OBpueZu+mMsuOBleOCjOOBn1xuICAgICAgICAgICAgLy8g5YWD44Gu44Kz44O844Or44OQ44OD44Kv44KS6L+96Leh44GZ44KLXG4gICAgICAgICAgICBjb25zdCBvcmlnaW5hbENhbGxiYWNrID0gY2FsbGJhY2suX29yaWdpbmFsQ2FsbGJhY2s7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIHNoYXJlT25jZUxpc3RlbmVycyDjg6Ljg7zjg4nmmYLjgIHjgZnjgafjgavlkbzjgbPlh7rjgZXjgozjgZ/jgrPjg7zjg6vjg5Djg4Pjgq/jga/jgrnjgq3jg4Pjg5dcbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc2hhcmVPbmNlTGlzdGVuZXJzICYmIFxuICAgICAgICAgICAgICAgIG9yaWdpbmFsQ2FsbGJhY2sgJiYgXG4gICAgICAgICAgICAgICAgdGhpcy5faW52b2tlZENhbGxiYWNrcy5oYXMob3JpZ2luYWxDYWxsYmFjaykpIHtcbiAgICAgICAgICAgICAgLy8g5a6f6KGM5riI44G/44Gu44Kz44O844Or44OQ44OD44Kv44Gu44Oq44K544OK44O844Gv44Oq44K544OI44GL44KJ6Zmk5Y67XG4gICAgICAgICAgICAgIGlmIChvbmNlKSB7XG4gICAgICAgICAgICAgICAgbGlzdGVuZXJzVG9SZW1vdmUucHVzaCh7IG5hbWUsIGNhbGxiYWNrIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAvLyDnj77lnKjjga7jgqTjg5njg7Pjg4jlkI3jgpLoqK3lrprvvIhvbmNl44Oq44K544OK44O844GM6Ieq5YiG6Ieq6Lqr44KS5YmK6Zmk44GZ44KL44Gf44KB44Gr5b+F6KaB77yJXG4gICAgICAgICAgICAgIGNvbnN0IHByZXZpb3VzRXZlbnROYW1lID0gdGhpcy5fY3VycmVudEV2ZW50TmFtZTtcbiAgICAgICAgICAgICAgdGhpcy5fY3VycmVudEV2ZW50TmFtZSA9IG5hbWU7XG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAvLyBDYWxsIHRoZSBsaXN0ZW5lciB3aXRoIHRoZSBldmVudCBkYXRhXG4gICAgICAgICAgICAgIGNhbGxiYWNrKGRhdGEpO1xuICAgICAgICAgICAgICBsaXN0ZW5lcnNDYWxsZWQgPSB0cnVlO1xuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgLy8gb3JpZ2luYWxDYWxsYmFjayDjgYzjgYLjgozjgbDlkbzjgbPlh7rjgZfmuIjjgb/jgajjgZfjgabjg57jg7zjgq9cbiAgICAgICAgICAgICAgaWYgKG9yaWdpbmFsQ2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9pbnZva2VkQ2FsbGJhY2tzLmFkZChvcmlnaW5hbENhbGxiYWNrKTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIC8vIOOCpOODmeODs+ODiOWQjeOCkuWFg+OBq+aIu+OBmVxuICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50RXZlbnROYW1lID0gcHJldmlvdXNFdmVudE5hbWU7XG5cbiAgICAgICAgICAgICAgLy8gSWYgaXQncyBhIG9uY2UgbGlzdGVuZXIsIG1hcmsgaXQgZm9yIHJlbW92YWxcbiAgICAgICAgICAgICAgLy8gTm90ZTogVGhlIHdyYXBwZXIgc2hvdWxkIGhhdmUgYXV0by1yZW1vdmVkIGl0c2VsZiBhbHJlYWR5XG4gICAgICAgICAgICAgIC8vIFRoaXMgaXMganVzdCBhIHNhZmV0eSBuZXRcbiAgICAgICAgICAgICAgaWYgKG9uY2UpIHtcbiAgICAgICAgICAgICAgICBsaXN0ZW5lcnNUb1JlbW92ZS5wdXNoKHsgbmFtZSwgY2FsbGJhY2sgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgIC8vIExvZyB0aGUgZXJyb3IgYnV0IGNvbnRpbnVlIHdpdGggb3RoZXIgbGlzdGVuZXJzXG4gICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIGluIGV2ZW50IGxpc3RlbmVyIGZvciAnJHtuYW1lfSc6YCwgZXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyDlhajjgabjga7jg6rjgrnjg4rjg7zlrp/ooYzlvozjgavjgIHkuIDluqbjgaDjgZHliYrpmaTlh6bnkIbjgpLooYzjgYZcbiAgICAgIC8vIOOBk+OCjOOBr+S4u+OBq+OCu+ODvOODleODhuOCo+ODjeODg+ODiOOBqOOBl+OBpuapn+iDveOBl+OBvuOBmVxuICAgICAgZm9yIChjb25zdCB7IG5hbWUsIGNhbGxiYWNrIH0gb2YgbGlzdGVuZXJzVG9SZW1vdmUpIHtcbiAgICAgICAgLy8g44Oq44K544OK44O844KS5YmK6ZmkXG4gICAgICAgIGlmICh0aGlzLmxpc3RlbmVycy5oYXMobmFtZSkpIHtcbiAgICAgICAgICBjb25zdCBsaXN0ZW5lcnMgPSB0aGlzLmxpc3RlbmVycy5nZXQobmFtZSk7XG4gICAgICAgICAgY29uc3QgdXBkYXRlZExpc3RlbmVycyA9IGxpc3RlbmVycy5maWx0ZXIobCA9PiBsLmNhbGxiYWNrICE9PSBjYWxsYmFjayk7XG4gICAgICAgICAgXG4gICAgICAgICAgaWYgKHVwZGF0ZWRMaXN0ZW5lcnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB0aGlzLmxpc3RlbmVycy5kZWxldGUobmFtZSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubGlzdGVuZXJzLnNldChuYW1lLCB1cGRhdGVkTGlzdGVuZXJzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gUHJvY2VzcyBwZW5kaW5nIGFkZGl0aW9ucyBhbmQgcmVtb3ZhbHMgKGlmIHdlJ3JlIG5vdCBpbiBhIG5lc3RlZCBlbWl0KVxuICAgICAgaWYgKCF3YXNFbWl0dGluZykge1xuICAgICAgICB0aGlzLl9wcm9jZXNzUGVuZGluZ09wZXJhdGlvbnMoKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGxpc3RlbmVyc0NhbGxlZDtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgLy8g5pyA5aSW6YOo44GuIGVtaXQg5ZG844Gz5Ye644GX44GM57WC5LqG44GX44Gf44KJIGVtaXR0aW5nIOODleODqeOCsOOCkuODquOCu+ODg+ODiFxuICAgICAgaWYgKCF3YXNFbWl0dGluZykge1xuICAgICAgICB0aGlzLl9lbWl0dGluZyA9IGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiBhbiBldmVudCBoYXMgYW55IGxpc3RlbmVyc1xuICAgKiBAcGFyYW0ge3N0cmluZ30gZXZlbnROYW1lIC0gTmFtZSBvZiB0aGUgZXZlbnQgdG8gY2hlY2tcbiAgICogQHJldHVybiB7Ym9vbGVhbn0gLSBUcnVlIGlmIHRoZSBldmVudCBoYXMgbGlzdGVuZXJzLCBmYWxzZSBvdGhlcndpc2VcbiAgICovXG4gIGhhc0xpc3RlbmVycyhldmVudE5hbWUpIHtcbiAgICAvLyBEaXJlY3QgbWF0Y2hcbiAgICBpZiAodGhpcy5saXN0ZW5lcnMuaGFzKGV2ZW50TmFtZSkgJiYgdGhpcy5saXN0ZW5lcnMuZ2V0KGV2ZW50TmFtZSkubGVuZ3RoID4gMCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgLy8gSWYgd2lsZGNhcmRzIGFyZSBlbmFibGVkLCBjaGVjayBmb3Igd2lsZGNhcmQgbWF0Y2hlc1xuICAgIGlmICh0aGlzLm9wdGlvbnMuZW5hYmxlV2lsZGNhcmRzKSB7XG4gICAgICAvLyDmnIDpganljJY6IOacgOWkp+ODgeOCp+ODg+OCr+aVsOOCkuWItumZkFxuICAgICAgbGV0IGNoZWNrZWQgPSAwO1xuICAgICAgY29uc3QgbWF4VG9DaGVjayA9IDEwMDtcbiAgICAgIFxuICAgICAgZm9yIChjb25zdCBbbmFtZSwgbGlzdGVuZXJzXSBvZiB0aGlzLmxpc3RlbmVycy5lbnRyaWVzKCkpIHtcbiAgICAgICAgaWYgKCsrY2hlY2tlZCA+IG1heFRvQ2hlY2spIGJyZWFrO1xuICAgICAgICBcbiAgICAgICAgaWYgKGxpc3RlbmVycy5sZW5ndGggPiAwICYmIG5hbWUuaW5jbHVkZXMoJyonKSAmJiB0aGlzLl9tYXRjaGVzV2lsZGNhcmQobmFtZSwgZXZlbnROYW1lKSkge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgbnVtYmVyIG9mIGxpc3RlbmVycyBmb3IgYW4gZXZlbnRcbiAgICogQHBhcmFtIHtzdHJpbmd9IGV2ZW50TmFtZSAtIE5hbWUgb2YgdGhlIGV2ZW50IHRvIGNoZWNrXG4gICAqIEByZXR1cm4ge251bWJlcn0gLSBOdW1iZXIgb2YgbGlzdGVuZXJzIGZvciB0aGUgZXZlbnRcbiAgICovXG4gIGxpc3RlbmVyQ291bnQoZXZlbnROYW1lKSB7XG4gICAgbGV0IGNvdW50ID0gMDtcblxuICAgIC8vIERpcmVjdCBtYXRjaFxuICAgIGlmICh0aGlzLmxpc3RlbmVycy5oYXMoZXZlbnROYW1lKSkge1xuICAgICAgY291bnQgKz0gdGhpcy5saXN0ZW5lcnMuZ2V0KGV2ZW50TmFtZSkubGVuZ3RoO1xuICAgIH1cblxuICAgIC8vIElmIHdpbGRjYXJkcyBhcmUgZW5hYmxlZCwgY2hlY2sgZm9yIHdpbGRjYXJkIG1hdGNoZXNcbiAgICBpZiAodGhpcy5vcHRpb25zLmVuYWJsZVdpbGRjYXJkcykge1xuICAgICAgLy8g5pyA6YGp5YyWOiDmnIDlpKfjg4Hjgqfjg4Pjgq/mlbDjgpLliLbpmZBcbiAgICAgIGxldCBjaGVja2VkID0gMDtcbiAgICAgIGNvbnN0IG1heFRvQ2hlY2sgPSAxMDA7XG4gICAgICBcbiAgICAgIGZvciAoY29uc3QgW25hbWUsIGxpc3RlbmVyc10gb2YgdGhpcy5saXN0ZW5lcnMuZW50cmllcygpKSB7XG4gICAgICAgIGlmICgrK2NoZWNrZWQgPiBtYXhUb0NoZWNrKSBicmVhaztcbiAgICAgICAgXG4gICAgICAgIGlmIChuYW1lICE9PSBldmVudE5hbWUgJiYgbmFtZS5pbmNsdWRlcygnKicpICYmIHRoaXMuX21hdGNoZXNXaWxkY2FyZChuYW1lLCBldmVudE5hbWUpKSB7XG4gICAgICAgICAgY291bnQgKz0gbGlzdGVuZXJzLmxlbmd0aDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBjb3VudDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYWxsIHJlZ2lzdGVyZWQgZXZlbnQgbmFtZXNcbiAgICogQHJldHVybiB7c3RyaW5nW119IC0gQXJyYXkgb2YgcmVnaXN0ZXJlZCBldmVudCBuYW1lc1xuICAgKi9cbiAgZXZlbnROYW1lcygpIHtcbiAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLmxpc3RlbmVycy5rZXlzKCkpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgcmVjZW50IGV2ZW50IGhpc3RvcnkgKG9ubHkgYXZhaWxhYmxlIGluIGRlYnVnIG1vZGUpXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBbbGltaXQ9MTBdIC0gTWF4aW11bSBudW1iZXIgb2YgZXZlbnRzIHRvIHJldHVyblxuICAgKiBAcmV0dXJuIHtBcnJheX0gLSBBcnJheSBvZiByZWNlbnQgZXZlbnRzIG9yIGVtcHR5IGFycmF5IGlmIGRlYnVnIG1vZGUgaXMgZGlzYWJsZWRcbiAgICovXG4gIGdldEV2ZW50SGlzdG9yeShsaW1pdCA9IDEwKSB7XG4gICAgaWYgKCF0aGlzLm9wdGlvbnMuZGVidWdNb2RlKSB7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgY29uc3QgYWN0dWFsTGltaXQgPSBNYXRoLm1pbihsaW1pdCwgdGhpcy5ldmVudEhpc3RvcnkubGVuZ3RoKTtcbiAgICByZXR1cm4gdGhpcy5ldmVudEhpc3Rvcnkuc2xpY2UoLWFjdHVhbExpbWl0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhciBhbGwgZXZlbnQgbGlzdGVuZXJzXG4gICAqIEByZXR1cm4ge0V2ZW50U3lzdGVtfSAtIFJldHVybnMgdGhpcyBpbnN0YW5jZSBmb3IgY2hhaW5pbmdcbiAgICovXG4gIHJlbW92ZUFsbExpc3RlbmVycygpIHtcbiAgICB0aGlzLmxpc3RlbmVycy5jbGVhcigpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIFByb2Nlc3MgcGVuZGluZyBsaXN0ZW5lciBhZGRpdGlvbnMgYW5kIHJlbW92YWxzXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBfcHJvY2Vzc1BlbmRpbmdPcGVyYXRpb25zKCkge1xuICAgIC8vIOacgOmBqeWMljog5aSn6YeP44Gu44Oa44Oz44OH44Kj44Oz44Kw5pON5L2c44GM44GC44KL5aC05ZCI44Gu44Ks44O844OJXG4gICAgY29uc3QgbWF4T3BlcmF0aW9ucyA9IDEwMDA7XG4gICAgXG4gICAgLy8gUHJvY2VzcyByZW1vdmFscyBmaXJzdCB0byBhdm9pZCBpc3N1ZXMgd2l0aCBhZGRpdGlvbnMgdGhhdCB3b3VsZCBiZSBpbW1lZGlhdGVseSByZW1vdmVkXG4gICAgY29uc3QgcmVtb3ZhbHNUb1Byb2Nlc3MgPSBNYXRoLm1pbih0aGlzLl9wZW5kaW5nUmVtb3ZhbHMubGVuZ3RoLCBtYXhPcGVyYXRpb25zKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJlbW92YWxzVG9Qcm9jZXNzOyBpKyspIHtcbiAgICAgIGNvbnN0IHsgZXZlbnROYW1lLCBjYWxsYmFjayB9ID0gdGhpcy5fcGVuZGluZ1JlbW92YWxzW2ldO1xuICAgICAgdGhpcy5vZmYoZXZlbnROYW1lLCBjYWxsYmFjayk7XG4gICAgfVxuICAgIFxuICAgIC8vIOWHpueQhuOBl+OBn+WIhuOBoOOBkemFjeWIl+OBi+OCieWJiumZpFxuICAgIGlmIChyZW1vdmFsc1RvUHJvY2VzcyA9PT0gdGhpcy5fcGVuZGluZ1JlbW92YWxzLmxlbmd0aCkge1xuICAgICAgdGhpcy5fcGVuZGluZ1JlbW92YWxzID0gW107XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX3BlbmRpbmdSZW1vdmFscyA9IHRoaXMuX3BlbmRpbmdSZW1vdmFscy5zbGljZShyZW1vdmFsc1RvUHJvY2Vzcyk7XG4gICAgfVxuXG4gICAgLy8gVGhlbiBwcm9jZXNzIGFkZGl0aW9uc1xuICAgIGNvbnN0IGFkZGl0aW9uc1RvUHJvY2VzcyA9IE1hdGgubWluKHRoaXMuX3BlbmRpbmdBZGRpdGlvbnMubGVuZ3RoLCBtYXhPcGVyYXRpb25zKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFkZGl0aW9uc1RvUHJvY2VzczsgaSsrKSB7XG4gICAgICBjb25zdCB7IGV2ZW50TmFtZSwgY2FsbGJhY2ssIHByaW9yaXR5LCBvbmNlIH0gPSB0aGlzLl9wZW5kaW5nQWRkaXRpb25zW2ldO1xuICAgICAgaWYgKG9uY2UpIHtcbiAgICAgICAgdGhpcy5vbmNlKGV2ZW50TmFtZSwgY2FsbGJhY2ssIHByaW9yaXR5KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMub24oZXZlbnROYW1lLCBjYWxsYmFjaywgcHJpb3JpdHkpO1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyDlh6bnkIbjgZfjgZ/liIbjgaDjgZHphY3liJfjgYvjgonliYrpmaRcbiAgICBpZiAoYWRkaXRpb25zVG9Qcm9jZXNzID09PSB0aGlzLl9wZW5kaW5nQWRkaXRpb25zLmxlbmd0aCkge1xuICAgICAgdGhpcy5fcGVuZGluZ0FkZGl0aW9ucyA9IFtdO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9wZW5kaW5nQWRkaXRpb25zID0gdGhpcy5fcGVuZGluZ0FkZGl0aW9ucy5zbGljZShhZGRpdGlvbnNUb1Byb2Nlc3MpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgYW4gZXZlbnQgdG8gdGhlIGhpc3RvcnlcbiAgICogQHBhcmFtIHtzdHJpbmd9IGV2ZW50TmFtZSAtIE5hbWUgb2YgdGhlIGVtaXR0ZWQgZXZlbnRcbiAgICogQHBhcmFtIHsqfSBkYXRhIC0gRGF0YSBwYXNzZWQgd2l0aCB0aGUgZXZlbnRcbiAgICogQHByaXZhdGVcbiAgICovXG4gIF9hZGRUb0hpc3RvcnkoZXZlbnROYW1lLCBkYXRhKSB7XG4gICAgLy8gQWRkIHRvIGhpc3Rvcnkgd2l0aCB0aW1lc3RhbXBcbiAgICB0aGlzLmV2ZW50SGlzdG9yeS5wdXNoKHtcbiAgICAgIGV2ZW50TmFtZSxcbiAgICAgIGRhdGEsXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKClcbiAgICB9KTtcblxuICAgIC8vIFRyaW0gaGlzdG9yeSBpZiBpdCBleGNlZWRzIHRoZSBsaW1pdFxuICAgIGlmICh0aGlzLmV2ZW50SGlzdG9yeS5sZW5ndGggPiB0aGlzLm9wdGlvbnMuaGlzdG9yeUxpbWl0KSB7XG4gICAgICB0aGlzLmV2ZW50SGlzdG9yeS5zaGlmdCgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYWxsIGV2ZW50IG5hbWVzIHRvIGVtaXQgYmFzZWQgb24gdGhlIG9yaWdpbmFsIGV2ZW50IGFuZCBvcHRpb25zXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBldmVudE5hbWUgLSBUaGUgb3JpZ2luYWwgZXZlbnQgbmFtZVxuICAgKiBAcmV0dXJuIHtzdHJpbmdbXX0gLSBBcnJheSBvZiBldmVudCBuYW1lcyB0byBlbWl0XG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBfZ2V0RXZlbnROYW1lc0ZvckVtaXNzaW9uKGV2ZW50TmFtZSkge1xuICAgIGNvbnN0IGV2ZW50TmFtZXMgPSBbZXZlbnROYW1lXTtcblxuICAgIC8vIEFkZCBuYW1lc3BhY2UgcGFyZW50IGV2ZW50cyBpZiBlbmFibGVkXG4gICAgaWYgKHRoaXMub3B0aW9ucy5lbmFibGVOYW1lc3BhY2VzICYmIGV2ZW50TmFtZS5pbmNsdWRlcygnLicpKSB7XG4gICAgICBjb25zdCBwYXJ0cyA9IGV2ZW50TmFtZS5zcGxpdCgnLicpO1xuICAgICAgLy8g5pyA6YGp5YyWOiDkuIDluqbjgavlhajpg6jjgpLoqIjnrpfjgZvjgZrlvpDjgIXjgavopqrlkI3liY3nqbrplpPjgpLmp4vnr4lcbiAgICAgIGxldCBwYXJlbnROYW1lID0gJyc7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBhcnRzLmxlbmd0aCAtIDE7IGkrKykge1xuICAgICAgICBwYXJlbnROYW1lID0gcGFyZW50TmFtZSA/IGAke3BhcmVudE5hbWV9LiR7cGFydHNbaV19YCA6IHBhcnRzW2ldO1xuICAgICAgICBldmVudE5hbWVzLnB1c2gocGFyZW50TmFtZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8g5pyA6YGp5YyWOiDjg6/jgqTjg6vjg4njgqvjg7zjg4njgYzmnInlirnjgarloLTlkIjjga/jgIHlv4XopoHjgarjg6rjgrnjg4rjg7zjga7jgb/jg57jg4Pjg4Hjg7PjgrDjgZnjgotcbiAgICBpZiAodGhpcy5vcHRpb25zLmVuYWJsZVdpbGRjYXJkcykge1xuICAgICAgLy8g5pyA6YGp5YyWOiDjg6rjgrnjg4rjg7zjga7mlbDjgYzlpJrjgZnjgY7jgovloLTlkIjjga/liLbpmZDjgZnjgotcbiAgICAgIGNvbnN0IG1heExpc3RlbmVyc1RvQ2hlY2sgPSAxMDA7XG4gICAgICBsZXQgY2hlY2tlZENvdW50ID0gMDtcbiAgICAgIFxuICAgICAgZm9yIChjb25zdCBuYW1lIG9mIHRoaXMubGlzdGVuZXJzLmtleXMoKSkge1xuICAgICAgICAvLyDjg6/jgqTjg6vjg4njgqvjg7zjg4nmloflrZfjgpLlkKvjgoDloLTlkIjjga7jgb/jg4Hjgqfjg4Pjgq9cbiAgICAgICAgaWYgKCFuYW1lLmluY2x1ZGVzKCcqJykpIGNvbnRpbnVlO1xuICAgICAgICBcbiAgICAgICAgLy8g5Yem55CG5riI44G/44Gu44Kk44OZ44Oz44OI5ZCN44Gv44K544Kt44OD44OXXG4gICAgICAgIGlmIChldmVudE5hbWVzLmluY2x1ZGVzKG5hbWUpKSBjb250aW51ZTtcbiAgICAgICAgXG4gICAgICAgIC8vIOacgOWkp+WItumZkOOBq+mBlOOBl+OBn+OCieWBnOatolxuICAgICAgICBpZiAoKytjaGVja2VkQ291bnQgPiBtYXhMaXN0ZW5lcnNUb0NoZWNrKSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIOODr+OCpOODq+ODieOCq+ODvOODieODkeOCv+ODvOODs+OBruewoeaYk+ODgeOCp+ODg+OCr1xuICAgICAgICBpZiAodGhpcy5fbWF0Y2hlc1dpbGRjYXJkKG5hbWUsIGV2ZW50TmFtZSkpIHtcbiAgICAgICAgICBldmVudE5hbWVzLnB1c2gobmFtZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gZXZlbnROYW1lcztcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiBhIHdpbGRjYXJkIHBhdHRlcm4gbWF0Y2hlcyBhbiBldmVudCBuYW1lXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBwYXR0ZXJuIC0gVGhlIHdpbGRjYXJkIHBhdHRlcm4gdG8gY2hlY2tcbiAgICogQHBhcmFtIHtzdHJpbmd9IGV2ZW50TmFtZSAtIFRoZSBldmVudCBuYW1lIHRvIG1hdGNoIGFnYWluc3RcbiAgICogQHJldHVybiB7Ym9vbGVhbn0gLSBUcnVlIGlmIHRoZSBwYXR0ZXJuIG1hdGNoZXMgdGhlIGV2ZW50IG5hbWVcbiAgICogQHByaXZhdGVcbiAgICovXG4gIF9tYXRjaGVzV2lsZGNhcmQocGF0dGVybiwgZXZlbnROYW1lKSB7XG4gICAgLy8g44OR44K/44O844Oz44KE5ZCN5YmN44GM55Ww5bi444Gr6ZW344GE5aC05ZCI44Gv44Oe44OD44OB44Oz44Kw44KS6Kum44KB44KL77yI5a6J5YWo5a++562W77yJXG4gICAgaWYgKHBhdHRlcm4ubGVuZ3RoID4gMTAwMCB8fCBldmVudE5hbWUubGVuZ3RoID4gMTAwMCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIOWNmOe0lOOBquODgeOCp+ODg+OCr1xuICAgIGlmIChwYXR0ZXJuID09PSBldmVudE5hbWUpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIC8vIOWNmOe0lOOBquODr+OCpOODq+ODieOCq+ODvOODieODgeOCp+ODg+OCr1xuICAgIGlmIChwYXR0ZXJuID09PSAnKicpIHtcbiAgICAgIHJldHVybiAhZXZlbnROYW1lLmluY2x1ZGVzKCcuJyk7XG4gICAgfVxuXG4gICAgaWYgKHBhdHRlcm4gPT09ICcqKicpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIC8vIOikh+aVsOmajuWxpOOBruODr+OCpOODq+ODieOCq+ODvOODiSAoKiopIOOBruWHpueQhlxuICAgIGlmIChwYXR0ZXJuLmluY2x1ZGVzKCcqKicpKSB7XG4gICAgICBjb25zdCBwYXJ0cyA9IHBhdHRlcm4uc3BsaXQoJyoqJyk7XG4gICAgICBcbiAgICAgIC8vIOacgOmBqeWMljog5pyA5aSnMuOBpOOBruODkeODvOODiOOBruOBv+OCkuOCteODneODvOODiFxuICAgICAgaWYgKHBhcnRzLmxlbmd0aCA+IDIpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICAvLyDjg5Hjgr/jg7zjg7PjgYwgJ2dhbWUuKionIOOBruOCiOOBhuOBquW9ouW8j+OBruWgtOWQiFxuICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMiAmJiBwYXJ0c1sxXSA9PT0gJycpIHtcbiAgICAgICAgcmV0dXJuIGV2ZW50TmFtZS5zdGFydHNXaXRoKHBhcnRzWzBdKTtcbiAgICAgIH1cblxuICAgICAgLy8g44OR44K/44O844Oz44GMICcqKi5lbmQnIOOBruOCiOOBhuOBquW9ouW8j+OBruWgtOWQiFxuICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMiAmJiBwYXJ0c1swXSA9PT0gJycpIHtcbiAgICAgICAgcmV0dXJuIGV2ZW50TmFtZS5lbmRzV2l0aChwYXJ0c1sxXSk7XG4gICAgICB9XG5cbiAgICAgIC8vIOODkeOCv+ODvOODs+OBjCAnc3RhcnQuKiouZW5kJyDjga7jgojjgYbjgarlvaLlvI/jga7loLTlkIhcbiAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHtcbiAgICAgICAgcmV0dXJuIGV2ZW50TmFtZS5zdGFydHNXaXRoKHBhcnRzWzBdKSAmJiBldmVudE5hbWUuZW5kc1dpdGgocGFydHNbMV0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIOWNmOS4gOmajuWxpOOBruODr+OCpOODq+ODieOCq+ODvOODiSAoKikg44Gu5Yem55CGXG4gICAgaWYgKHBhdHRlcm4uaW5jbHVkZXMoJyonKSAmJiAhcGF0dGVybi5pbmNsdWRlcygnKionKSkge1xuICAgICAgLy8g5q2j6KaP6KGo54++44KS5L2/44KP44Gq44GE5pyA6YGp5YyW44GV44KM44Gf5pa55rOVXG4gICAgICBjb25zdCBwYXR0ZXJuUGFydHMgPSBwYXR0ZXJuLnNwbGl0KCcuJyk7XG4gICAgICBjb25zdCBldmVudFBhcnRzID0gZXZlbnROYW1lLnNwbGl0KCcuJyk7XG4gICAgICBcbiAgICAgIGlmIChwYXR0ZXJuUGFydHMubGVuZ3RoICE9PSBldmVudFBhcnRzLmxlbmd0aCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGF0dGVyblBhcnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmIChwYXR0ZXJuUGFydHNbaV0gPT09ICcqJykge1xuICAgICAgICAgIGNvbnRpbnVlOyAvLyDjg6/jgqTjg6vjg4njgqvjg7zjg4njga/kvZXjgavjgoLjg57jg4Pjg4HjgZnjgotcbiAgICAgICAgfVxuICAgICAgICBpZiAocGF0dGVyblBhcnRzW2ldICE9PSBldmVudFBhcnRzW2ldKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBFdmVudFN5c3RlbTsiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxNQUFNQSxXQUFXLENBQUM7RUFDaEI7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ0VDLFdBQVdBLENBQUNDLE9BQU8sR0FBRyxDQUFDLENBQUMsRUFBRTtJQUN4QjtJQUNBLElBQUksQ0FBQ0EsT0FBTyxHQUFHO01BQ2JDLGdCQUFnQixFQUFFLElBQUk7TUFDdEJDLFNBQVMsRUFBRSxLQUFLO01BQ2hCQyxlQUFlLEVBQUUsS0FBSztNQUN0QkMsWUFBWSxFQUFFLEdBQUc7TUFDakJDLGtCQUFrQixFQUFFLEtBQUs7TUFDekIsR0FBR0w7SUFDTCxDQUFDOztJQUVEO0lBQ0EsSUFBSSxDQUFDTSxTQUFTLEdBQUcsSUFBSUMsR0FBRyxDQUFDLENBQUM7O0lBRTFCO0lBQ0EsSUFBSSxDQUFDQyxZQUFZLEdBQUcsRUFBRTs7SUFFdEI7SUFDQSxJQUFJLENBQUNDLFNBQVMsR0FBRyxLQUFLOztJQUV0QjtJQUNBLElBQUksQ0FBQ0MsaUJBQWlCLEdBQUcsRUFBRTtJQUMzQixJQUFJLENBQUNDLGdCQUFnQixHQUFHLEVBQUU7O0lBRTFCO0lBQ0EsSUFBSSxDQUFDQyxpQkFBaUIsR0FBRyxJQUFJQyxHQUFHLENBQUMsQ0FBQztFQUNwQzs7RUFFQTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ0VDLEVBQUVBLENBQUNDLFNBQVMsRUFBRUMsUUFBUSxFQUFFQyxRQUFRLEdBQUcsQ0FBQyxFQUFFO0lBQ3BDO0lBQ0EsSUFBSSxPQUFPRixTQUFTLEtBQUssUUFBUSxJQUFJQSxTQUFTLENBQUNHLElBQUksQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFO01BQzVELE1BQU0sSUFBSUMsS0FBSyxDQUFDLHVDQUF1QyxDQUFDO0lBQzFEO0lBRUEsSUFBSSxPQUFPSCxRQUFRLEtBQUssVUFBVSxFQUFFO01BQ2xDLE1BQU0sSUFBSUcsS0FBSyxDQUFDLDZCQUE2QixDQUFDO0lBQ2hEOztJQUVBO0lBQ0EsSUFBSSxJQUFJLENBQUNWLFNBQVMsRUFBRTtNQUNsQixJQUFJLENBQUNDLGlCQUFpQixDQUFDVSxJQUFJLENBQUM7UUFBRUwsU0FBUztRQUFFQyxRQUFRO1FBQUVDLFFBQVE7UUFBRUksSUFBSSxFQUFFO01BQU0sQ0FBQyxDQUFDO01BQzNFLE9BQU8sSUFBSTtJQUNiOztJQUVBO0lBQ0EsSUFBSSxDQUFDLElBQUksQ0FBQ2YsU0FBUyxDQUFDZ0IsR0FBRyxDQUFDUCxTQUFTLENBQUMsRUFBRTtNQUNsQyxJQUFJLENBQUNULFNBQVMsQ0FBQ2lCLEdBQUcsQ0FBQ1IsU0FBUyxFQUFFLEVBQUUsQ0FBQztJQUNuQztJQUVBLE1BQU1ULFNBQVMsR0FBRyxJQUFJLENBQUNBLFNBQVMsQ0FBQ2tCLEdBQUcsQ0FBQ1QsU0FBUyxDQUFDOztJQUUvQztJQUNBLE1BQU1VLGFBQWEsR0FBR25CLFNBQVMsQ0FBQ29CLFNBQVMsQ0FBQ0MsUUFBUSxJQUFJQSxRQUFRLENBQUNYLFFBQVEsS0FBS0EsUUFBUSxDQUFDO0lBQ3JGLElBQUlTLGFBQWEsS0FBSyxDQUFDLENBQUMsRUFBRTtNQUN4QjtNQUNBbkIsU0FBUyxDQUFDbUIsYUFBYSxDQUFDLENBQUNSLFFBQVEsR0FBR0EsUUFBUTtJQUM5QyxDQUFDLE1BQU07TUFDTDtNQUNBWCxTQUFTLENBQUNjLElBQUksQ0FBQztRQUFFSixRQUFRO1FBQUVLLElBQUksRUFBRSxLQUFLO1FBQUVKO01BQVMsQ0FBQyxDQUFDOztNQUVuRDtNQUNBWCxTQUFTLENBQUNzQixJQUFJLENBQUMsQ0FBQ0MsQ0FBQyxFQUFFQyxDQUFDLEtBQUtBLENBQUMsQ0FBQ2IsUUFBUSxHQUFHWSxDQUFDLENBQUNaLFFBQVEsQ0FBQztJQUNuRDtJQUVBLE9BQU8sSUFBSTtFQUNiOztFQUVBO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7RUFDRUksSUFBSUEsQ0FBQ04sU0FBUyxFQUFFQyxRQUFRLEVBQUVDLFFBQVEsR0FBRyxDQUFDLEVBQUU7SUFDdEM7SUFDQSxJQUFJLE9BQU9GLFNBQVMsS0FBSyxRQUFRLElBQUlBLFNBQVMsQ0FBQ0csSUFBSSxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUU7TUFDNUQsTUFBTSxJQUFJQyxLQUFLLENBQUMsdUNBQXVDLENBQUM7SUFDMUQ7SUFFQSxJQUFJLE9BQU9ILFFBQVEsS0FBSyxVQUFVLEVBQUU7TUFDbEMsTUFBTSxJQUFJRyxLQUFLLENBQUMsNkJBQTZCLENBQUM7SUFDaEQ7O0lBRUE7SUFDQSxJQUFJLENBQUMsSUFBSSxDQUFDWSxZQUFZLEVBQUU7TUFDdEIsSUFBSSxDQUFDQSxZQUFZLEdBQUcsSUFBSXhCLEdBQUcsQ0FBQyxDQUFDO0lBQy9COztJQUVBO0lBQ0EsSUFBSXlCLE9BQU87O0lBRVg7SUFDQSxJQUFJLElBQUksQ0FBQ0QsWUFBWSxDQUFDVCxHQUFHLENBQUNOLFFBQVEsQ0FBQyxFQUFFO01BQ25DZ0IsT0FBTyxHQUFHLElBQUksQ0FBQ0QsWUFBWSxDQUFDUCxHQUFHLENBQUNSLFFBQVEsQ0FBQzs7TUFFekM7TUFDQSxJQUFJLENBQUNnQixPQUFPLENBQUNDLFdBQVcsRUFBRTtRQUN4QkQsT0FBTyxDQUFDQyxXQUFXLEdBQUcsSUFBSXBCLEdBQUcsQ0FBQyxDQUFDO01BQ2pDO01BQ0FtQixPQUFPLENBQUNDLFdBQVcsQ0FBQ0MsR0FBRyxDQUFDbkIsU0FBUyxDQUFDO0lBQ3BDLENBQUMsTUFBTTtNQUNMO01BQ0FpQixPQUFPLEdBQUdBLENBQUMsR0FBR0csSUFBSSxLQUFLO1FBQ3JCO1FBQ0EsSUFBSSxJQUFJLENBQUNuQyxPQUFPLENBQUNLLGtCQUFrQixFQUFFO1VBQ25DO1VBQ0EsSUFBSTJCLE9BQU8sQ0FBQ0MsV0FBVyxFQUFFO1lBQ3ZCLE1BQU1HLFVBQVUsR0FBRyxDQUFDLEdBQUdKLE9BQU8sQ0FBQ0MsV0FBVyxDQUFDO1lBQzNDRyxVQUFVLENBQUNDLE9BQU8sQ0FBQ0MsSUFBSSxJQUFJO2NBQ3pCLElBQUksQ0FBQ0MsR0FBRyxDQUFDRCxJQUFJLEVBQUVOLE9BQU8sQ0FBQztZQUN6QixDQUFDLENBQUM7VUFDSjs7VUFFQTtVQUNBLElBQUksQ0FBQ0QsWUFBWSxDQUFDUyxNQUFNLENBQUN4QixRQUFRLENBQUM7UUFDcEMsQ0FBQyxNQUFNO1VBQ0w7VUFDQSxJQUFJLElBQUksQ0FBQ3lCLGlCQUFpQixFQUFFO1lBQzFCLElBQUksQ0FBQ0YsR0FBRyxDQUFDLElBQUksQ0FBQ0UsaUJBQWlCLEVBQUVULE9BQU8sQ0FBQztZQUN6QztZQUNBLElBQUlBLE9BQU8sQ0FBQ0MsV0FBVyxFQUFFO2NBQ3ZCRCxPQUFPLENBQUNDLFdBQVcsQ0FBQ08sTUFBTSxDQUFDLElBQUksQ0FBQ0MsaUJBQWlCLENBQUM7WUFDcEQ7O1lBRUE7WUFDQSxJQUFJVCxPQUFPLENBQUNDLFdBQVcsSUFBSUQsT0FBTyxDQUFDQyxXQUFXLENBQUNTLElBQUksS0FBSyxDQUFDLEVBQUU7Y0FDekQsSUFBSSxDQUFDWCxZQUFZLENBQUNTLE1BQU0sQ0FBQ3hCLFFBQVEsQ0FBQztZQUNwQztVQUNGO1FBQ0Y7O1FBRUE7UUFDQSxPQUFPQSxRQUFRLENBQUMyQixLQUFLLENBQUMsSUFBSSxFQUFFUixJQUFJLENBQUM7TUFDbkMsQ0FBQzs7TUFFRDtNQUNBSCxPQUFPLENBQUNZLGlCQUFpQixHQUFHNUIsUUFBUTs7TUFFcEM7TUFDQWdCLE9BQU8sQ0FBQ0MsV0FBVyxHQUFHLElBQUlwQixHQUFHLENBQUMsQ0FBQ0UsU0FBUyxDQUFDLENBQUM7O01BRTFDO01BQ0EsSUFBSSxDQUFDZ0IsWUFBWSxDQUFDUixHQUFHLENBQUNQLFFBQVEsRUFBRWdCLE9BQU8sQ0FBQztJQUMxQzs7SUFFQTtJQUNBLElBQUksSUFBSSxDQUFDdkIsU0FBUyxFQUFFO01BQ2xCLElBQUksQ0FBQ0MsaUJBQWlCLENBQUNVLElBQUksQ0FBQztRQUFFTCxTQUFTO1FBQUVDLFFBQVEsRUFBRWdCLE9BQU87UUFBRWYsUUFBUTtRQUFFSSxJQUFJLEVBQUU7TUFBSyxDQUFDLENBQUM7TUFDbkYsT0FBTyxJQUFJO0lBQ2I7O0lBRUE7SUFDQSxJQUFJLENBQUMsSUFBSSxDQUFDZixTQUFTLENBQUNnQixHQUFHLENBQUNQLFNBQVMsQ0FBQyxFQUFFO01BQ2xDLElBQUksQ0FBQ1QsU0FBUyxDQUFDaUIsR0FBRyxDQUFDUixTQUFTLEVBQUUsRUFBRSxDQUFDO0lBQ25DO0lBRUEsTUFBTVQsU0FBUyxHQUFHLElBQUksQ0FBQ0EsU0FBUyxDQUFDa0IsR0FBRyxDQUFDVCxTQUFTLENBQUM7O0lBRS9DO0lBQ0EsTUFBTVUsYUFBYSxHQUFHbkIsU0FBUyxDQUFDb0IsU0FBUyxDQUFDQyxRQUFRLElBQUlBLFFBQVEsQ0FBQ1gsUUFBUSxLQUFLZ0IsT0FBTyxDQUFDO0lBQ3BGLElBQUlQLGFBQWEsS0FBSyxDQUFDLENBQUMsRUFBRTtNQUN4QjtNQUNBbkIsU0FBUyxDQUFDbUIsYUFBYSxDQUFDLENBQUNSLFFBQVEsR0FBR0EsUUFBUTtJQUM5QyxDQUFDLE1BQU07TUFDTDtNQUNBWCxTQUFTLENBQUNjLElBQUksQ0FBQztRQUFFSixRQUFRLEVBQUVnQixPQUFPO1FBQUVYLElBQUksRUFBRSxJQUFJO1FBQUVKO01BQVMsQ0FBQyxDQUFDOztNQUUzRDtNQUNBWCxTQUFTLENBQUNzQixJQUFJLENBQUMsQ0FBQ0MsQ0FBQyxFQUFFQyxDQUFDLEtBQUtBLENBQUMsQ0FBQ2IsUUFBUSxHQUFHWSxDQUFDLENBQUNaLFFBQVEsQ0FBQztJQUNuRDtJQUVBLE9BQU8sSUFBSTtFQUNiOztFQUVBO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNFc0IsR0FBR0EsQ0FBQ3hCLFNBQVMsRUFBRUMsUUFBUSxHQUFHLElBQUksRUFBRTtJQUM5QjtJQUNBLElBQUksSUFBSSxDQUFDUCxTQUFTLEVBQUU7TUFDbEIsSUFBSSxDQUFDRSxnQkFBZ0IsQ0FBQ1MsSUFBSSxDQUFDO1FBQUVMLFNBQVM7UUFBRUM7TUFBUyxDQUFDLENBQUM7TUFDbkQsT0FBTyxJQUFJO0lBQ2I7O0lBRUE7SUFDQSxJQUFJLENBQUMsSUFBSSxDQUFDVixTQUFTLENBQUNnQixHQUFHLENBQUNQLFNBQVMsQ0FBQyxFQUFFO01BQ2xDLE9BQU8sSUFBSTtJQUNiOztJQUVBO0lBQ0EsSUFBSUMsUUFBUSxLQUFLLElBQUksRUFBRTtNQUNyQixJQUFJLENBQUNWLFNBQVMsQ0FBQ2tDLE1BQU0sQ0FBQ3pCLFNBQVMsQ0FBQztNQUNoQyxPQUFPLElBQUk7SUFDYjs7SUFFQTtJQUNBLE1BQU1ULFNBQVMsR0FBRyxJQUFJLENBQUNBLFNBQVMsQ0FBQ2tCLEdBQUcsQ0FBQ1QsU0FBUyxDQUFDO0lBQy9DLE1BQU04QixpQkFBaUIsR0FBR3ZDLFNBQVMsQ0FBQ3dDLE1BQU0sQ0FBQ25CLFFBQVEsSUFBSUEsUUFBUSxDQUFDWCxRQUFRLEtBQUtBLFFBQVEsQ0FBQztJQUV0RixJQUFJNkIsaUJBQWlCLENBQUNFLE1BQU0sS0FBSyxDQUFDLEVBQUU7TUFDbEM7TUFDQSxJQUFJLENBQUN6QyxTQUFTLENBQUNrQyxNQUFNLENBQUN6QixTQUFTLENBQUM7SUFDbEMsQ0FBQyxNQUFNO01BQ0w7TUFDQSxJQUFJLENBQUNULFNBQVMsQ0FBQ2lCLEdBQUcsQ0FBQ1IsU0FBUyxFQUFFOEIsaUJBQWlCLENBQUM7SUFDbEQ7SUFFQSxPQUFPLElBQUk7RUFDYjs7RUFFQTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7RUFDRUcsSUFBSUEsQ0FBQ2pDLFNBQVMsRUFBRWtDLElBQUksRUFBRTtJQUNwQjtJQUNBLE1BQU1DLFdBQVcsR0FBRyxJQUFJLENBQUN6QyxTQUFTO0lBQ2xDLElBQUksQ0FBQ0EsU0FBUyxHQUFHLElBQUk7O0lBRXJCO0lBQ0EsSUFBSSxDQUFDeUMsV0FBVyxFQUFFO01BQ2hCLElBQUksQ0FBQ3RDLGlCQUFpQixHQUFHLElBQUlDLEdBQUcsQ0FBQyxDQUFDO0lBQ3BDOztJQUVBO0lBQ0EsSUFBSXNDLGVBQWUsR0FBRyxLQUFLO0lBRTNCLElBQUk7TUFDRjtNQUNBLElBQUksSUFBSSxDQUFDbkQsT0FBTyxDQUFDRSxTQUFTLEVBQUU7UUFDMUIsSUFBSSxDQUFDa0QsYUFBYSxDQUFDckMsU0FBUyxFQUFFa0MsSUFBSSxDQUFDO01BQ3JDOztNQUVBO01BQ0EsTUFBTUksZ0JBQWdCLEdBQUcsSUFBSSxDQUFDQyx5QkFBeUIsQ0FBQ3ZDLFNBQVMsQ0FBQzs7TUFFbEU7TUFDQSxNQUFNd0MsaUJBQWlCLEdBQUcsRUFBRTs7TUFFNUI7TUFDQSxLQUFLLE1BQU1qQixJQUFJLElBQUllLGdCQUFnQixFQUFFO1FBQ25DLElBQUksSUFBSSxDQUFDL0MsU0FBUyxDQUFDZ0IsR0FBRyxDQUFDZ0IsSUFBSSxDQUFDLEVBQUU7VUFDNUI7VUFDQSxNQUFNaEMsU0FBUyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUNBLFNBQVMsQ0FBQ2tCLEdBQUcsQ0FBQ2MsSUFBSSxDQUFDLENBQUM7O1VBRS9DO1VBQ0EsS0FBSyxNQUFNWCxRQUFRLElBQUlyQixTQUFTLEVBQUU7WUFDaEMsTUFBTTtjQUFFVSxRQUFRO2NBQUVLO1lBQUssQ0FBQyxHQUFHTSxRQUFROztZQUVuQztZQUNBO1lBQ0EsTUFBTTZCLGdCQUFnQixHQUFHeEMsUUFBUSxDQUFDNEIsaUJBQWlCOztZQUVuRDtZQUNBLElBQUksSUFBSSxDQUFDNUMsT0FBTyxDQUFDSyxrQkFBa0IsSUFDL0JtRCxnQkFBZ0IsSUFDaEIsSUFBSSxDQUFDNUMsaUJBQWlCLENBQUNVLEdBQUcsQ0FBQ2tDLGdCQUFnQixDQUFDLEVBQUU7Y0FDaEQ7Y0FDQSxJQUFJbkMsSUFBSSxFQUFFO2dCQUNSa0MsaUJBQWlCLENBQUNuQyxJQUFJLENBQUM7a0JBQUVrQixJQUFJO2tCQUFFdEI7Z0JBQVMsQ0FBQyxDQUFDO2NBQzVDO2NBQ0E7WUFDRjtZQUVBLElBQUk7Y0FDRjtjQUNBLE1BQU15QyxpQkFBaUIsR0FBRyxJQUFJLENBQUNoQixpQkFBaUI7Y0FDaEQsSUFBSSxDQUFDQSxpQkFBaUIsR0FBR0gsSUFBSTs7Y0FFN0I7Y0FDQXRCLFFBQVEsQ0FBQ2lDLElBQUksQ0FBQztjQUNkRSxlQUFlLEdBQUcsSUFBSTs7Y0FFdEI7Y0FDQSxJQUFJSyxnQkFBZ0IsRUFBRTtnQkFDcEIsSUFBSSxDQUFDNUMsaUJBQWlCLENBQUNzQixHQUFHLENBQUNzQixnQkFBZ0IsQ0FBQztjQUM5Qzs7Y0FFQTtjQUNBLElBQUksQ0FBQ2YsaUJBQWlCLEdBQUdnQixpQkFBaUI7O2NBRTFDO2NBQ0E7Y0FDQTtjQUNBLElBQUlwQyxJQUFJLEVBQUU7Z0JBQ1JrQyxpQkFBaUIsQ0FBQ25DLElBQUksQ0FBQztrQkFBRWtCLElBQUk7a0JBQUV0QjtnQkFBUyxDQUFDLENBQUM7Y0FDNUM7WUFDRixDQUFDLENBQUMsT0FBTzBDLEtBQUssRUFBRTtjQUNkO2NBQ0FDLE9BQU8sQ0FBQ0QsS0FBSyxDQUFDLGdDQUFnQ3BCLElBQUksSUFBSSxFQUFFb0IsS0FBSyxDQUFDO1lBQ2hFO1VBQ0Y7UUFDRjtNQUNGOztNQUVBO01BQ0E7TUFDQSxLQUFLLE1BQU07UUFBRXBCLElBQUk7UUFBRXRCO01BQVMsQ0FBQyxJQUFJdUMsaUJBQWlCLEVBQUU7UUFDbEQ7UUFDQSxJQUFJLElBQUksQ0FBQ2pELFNBQVMsQ0FBQ2dCLEdBQUcsQ0FBQ2dCLElBQUksQ0FBQyxFQUFFO1VBQzVCLE1BQU1oQyxTQUFTLEdBQUcsSUFBSSxDQUFDQSxTQUFTLENBQUNrQixHQUFHLENBQUNjLElBQUksQ0FBQztVQUMxQyxNQUFNc0IsZ0JBQWdCLEdBQUd0RCxTQUFTLENBQUN3QyxNQUFNLENBQUNlLENBQUMsSUFBSUEsQ0FBQyxDQUFDN0MsUUFBUSxLQUFLQSxRQUFRLENBQUM7VUFFdkUsSUFBSTRDLGdCQUFnQixDQUFDYixNQUFNLEtBQUssQ0FBQyxFQUFFO1lBQ2pDLElBQUksQ0FBQ3pDLFNBQVMsQ0FBQ2tDLE1BQU0sQ0FBQ0YsSUFBSSxDQUFDO1VBQzdCLENBQUMsTUFBTTtZQUNMLElBQUksQ0FBQ2hDLFNBQVMsQ0FBQ2lCLEdBQUcsQ0FBQ2UsSUFBSSxFQUFFc0IsZ0JBQWdCLENBQUM7VUFDNUM7UUFDRjtNQUNGOztNQUVBO01BQ0EsSUFBSSxDQUFDVixXQUFXLEVBQUU7UUFDaEIsSUFBSSxDQUFDWSx5QkFBeUIsQ0FBQyxDQUFDO01BQ2xDO01BRUEsT0FBT1gsZUFBZTtJQUN4QixDQUFDLFNBQVM7TUFDUjtNQUNBLElBQUksQ0FBQ0QsV0FBVyxFQUFFO1FBQ2hCLElBQUksQ0FBQ3pDLFNBQVMsR0FBRyxLQUFLO01BQ3hCO0lBQ0Y7RUFDRjs7RUFFQTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0VBQ0VzRCxZQUFZQSxDQUFDaEQsU0FBUyxFQUFFO0lBQ3RCO0lBQ0EsSUFBSSxJQUFJLENBQUNULFNBQVMsQ0FBQ2dCLEdBQUcsQ0FBQ1AsU0FBUyxDQUFDLElBQUksSUFBSSxDQUFDVCxTQUFTLENBQUNrQixHQUFHLENBQUNULFNBQVMsQ0FBQyxDQUFDZ0MsTUFBTSxHQUFHLENBQUMsRUFBRTtNQUM3RSxPQUFPLElBQUk7SUFDYjs7SUFFQTtJQUNBLElBQUksSUFBSSxDQUFDL0MsT0FBTyxDQUFDRyxlQUFlLEVBQUU7TUFDaEM7TUFDQSxJQUFJNkQsT0FBTyxHQUFHLENBQUM7TUFDZixNQUFNQyxVQUFVLEdBQUcsR0FBRztNQUV0QixLQUFLLE1BQU0sQ0FBQzNCLElBQUksRUFBRWhDLFNBQVMsQ0FBQyxJQUFJLElBQUksQ0FBQ0EsU0FBUyxDQUFDNEQsT0FBTyxDQUFDLENBQUMsRUFBRTtRQUN4RCxJQUFJLEVBQUVGLE9BQU8sR0FBR0MsVUFBVSxFQUFFO1FBRTVCLElBQUkzRCxTQUFTLENBQUN5QyxNQUFNLEdBQUcsQ0FBQyxJQUFJVCxJQUFJLENBQUM2QixRQUFRLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDQyxnQkFBZ0IsQ0FBQzlCLElBQUksRUFBRXZCLFNBQVMsQ0FBQyxFQUFFO1VBQ3hGLE9BQU8sSUFBSTtRQUNiO01BQ0Y7SUFDRjtJQUVBLE9BQU8sS0FBSztFQUNkOztFQUVBO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7RUFDRXNELGFBQWFBLENBQUN0RCxTQUFTLEVBQUU7SUFDdkIsSUFBSXVELEtBQUssR0FBRyxDQUFDOztJQUViO0lBQ0EsSUFBSSxJQUFJLENBQUNoRSxTQUFTLENBQUNnQixHQUFHLENBQUNQLFNBQVMsQ0FBQyxFQUFFO01BQ2pDdUQsS0FBSyxJQUFJLElBQUksQ0FBQ2hFLFNBQVMsQ0FBQ2tCLEdBQUcsQ0FBQ1QsU0FBUyxDQUFDLENBQUNnQyxNQUFNO0lBQy9DOztJQUVBO0lBQ0EsSUFBSSxJQUFJLENBQUMvQyxPQUFPLENBQUNHLGVBQWUsRUFBRTtNQUNoQztNQUNBLElBQUk2RCxPQUFPLEdBQUcsQ0FBQztNQUNmLE1BQU1DLFVBQVUsR0FBRyxHQUFHO01BRXRCLEtBQUssTUFBTSxDQUFDM0IsSUFBSSxFQUFFaEMsU0FBUyxDQUFDLElBQUksSUFBSSxDQUFDQSxTQUFTLENBQUM0RCxPQUFPLENBQUMsQ0FBQyxFQUFFO1FBQ3hELElBQUksRUFBRUYsT0FBTyxHQUFHQyxVQUFVLEVBQUU7UUFFNUIsSUFBSTNCLElBQUksS0FBS3ZCLFNBQVMsSUFBSXVCLElBQUksQ0FBQzZCLFFBQVEsQ0FBQyxHQUFHLENBQUMsSUFBSSxJQUFJLENBQUNDLGdCQUFnQixDQUFDOUIsSUFBSSxFQUFFdkIsU0FBUyxDQUFDLEVBQUU7VUFDdEZ1RCxLQUFLLElBQUloRSxTQUFTLENBQUN5QyxNQUFNO1FBQzNCO01BQ0Y7SUFDRjtJQUVBLE9BQU91QixLQUFLO0VBQ2Q7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7RUFDRWxDLFVBQVVBLENBQUEsRUFBRztJQUNYLE9BQU9tQyxLQUFLLENBQUNDLElBQUksQ0FBQyxJQUFJLENBQUNsRSxTQUFTLENBQUNtRSxJQUFJLENBQUMsQ0FBQyxDQUFDO0VBQzFDOztFQUVBO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7RUFDRUMsZUFBZUEsQ0FBQ0MsS0FBSyxHQUFHLEVBQUUsRUFBRTtJQUMxQixJQUFJLENBQUMsSUFBSSxDQUFDM0UsT0FBTyxDQUFDRSxTQUFTLEVBQUU7TUFDM0IsT0FBTyxFQUFFO0lBQ1g7SUFFQSxNQUFNMEUsV0FBVyxHQUFHQyxJQUFJLENBQUNDLEdBQUcsQ0FBQ0gsS0FBSyxFQUFFLElBQUksQ0FBQ25FLFlBQVksQ0FBQ3VDLE1BQU0sQ0FBQztJQUM3RCxPQUFPLElBQUksQ0FBQ3ZDLFlBQVksQ0FBQ3VFLEtBQUssQ0FBQyxDQUFDSCxXQUFXLENBQUM7RUFDOUM7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7RUFDRUksa0JBQWtCQSxDQUFBLEVBQUc7SUFDbkIsSUFBSSxDQUFDMUUsU0FBUyxDQUFDMkUsS0FBSyxDQUFDLENBQUM7SUFDdEIsT0FBTyxJQUFJO0VBQ2I7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7RUFDRW5CLHlCQUF5QkEsQ0FBQSxFQUFHO0lBQzFCO0lBQ0EsTUFBTW9CLGFBQWEsR0FBRyxJQUFJOztJQUUxQjtJQUNBLE1BQU1DLGlCQUFpQixHQUFHTixJQUFJLENBQUNDLEdBQUcsQ0FBQyxJQUFJLENBQUNuRSxnQkFBZ0IsQ0FBQ29DLE1BQU0sRUFBRW1DLGFBQWEsQ0FBQztJQUMvRSxLQUFLLElBQUlFLENBQUMsR0FBRyxDQUFDLEVBQUVBLENBQUMsR0FBR0QsaUJBQWlCLEVBQUVDLENBQUMsRUFBRSxFQUFFO01BQzFDLE1BQU07UUFBRXJFLFNBQVM7UUFBRUM7TUFBUyxDQUFDLEdBQUcsSUFBSSxDQUFDTCxnQkFBZ0IsQ0FBQ3lFLENBQUMsQ0FBQztNQUN4RCxJQUFJLENBQUM3QyxHQUFHLENBQUN4QixTQUFTLEVBQUVDLFFBQVEsQ0FBQztJQUMvQjs7SUFFQTtJQUNBLElBQUltRSxpQkFBaUIsS0FBSyxJQUFJLENBQUN4RSxnQkFBZ0IsQ0FBQ29DLE1BQU0sRUFBRTtNQUN0RCxJQUFJLENBQUNwQyxnQkFBZ0IsR0FBRyxFQUFFO0lBQzVCLENBQUMsTUFBTTtNQUNMLElBQUksQ0FBQ0EsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDQSxnQkFBZ0IsQ0FBQ29FLEtBQUssQ0FBQ0ksaUJBQWlCLENBQUM7SUFDeEU7O0lBRUE7SUFDQSxNQUFNRSxrQkFBa0IsR0FBR1IsSUFBSSxDQUFDQyxHQUFHLENBQUMsSUFBSSxDQUFDcEUsaUJBQWlCLENBQUNxQyxNQUFNLEVBQUVtQyxhQUFhLENBQUM7SUFDakYsS0FBSyxJQUFJRSxDQUFDLEdBQUcsQ0FBQyxFQUFFQSxDQUFDLEdBQUdDLGtCQUFrQixFQUFFRCxDQUFDLEVBQUUsRUFBRTtNQUMzQyxNQUFNO1FBQUVyRSxTQUFTO1FBQUVDLFFBQVE7UUFBRUMsUUFBUTtRQUFFSTtNQUFLLENBQUMsR0FBRyxJQUFJLENBQUNYLGlCQUFpQixDQUFDMEUsQ0FBQyxDQUFDO01BQ3pFLElBQUkvRCxJQUFJLEVBQUU7UUFDUixJQUFJLENBQUNBLElBQUksQ0FBQ04sU0FBUyxFQUFFQyxRQUFRLEVBQUVDLFFBQVEsQ0FBQztNQUMxQyxDQUFDLE1BQU07UUFDTCxJQUFJLENBQUNILEVBQUUsQ0FBQ0MsU0FBUyxFQUFFQyxRQUFRLEVBQUVDLFFBQVEsQ0FBQztNQUN4QztJQUNGOztJQUVBO0lBQ0EsSUFBSW9FLGtCQUFrQixLQUFLLElBQUksQ0FBQzNFLGlCQUFpQixDQUFDcUMsTUFBTSxFQUFFO01BQ3hELElBQUksQ0FBQ3JDLGlCQUFpQixHQUFHLEVBQUU7SUFDN0IsQ0FBQyxNQUFNO01BQ0wsSUFBSSxDQUFDQSxpQkFBaUIsR0FBRyxJQUFJLENBQUNBLGlCQUFpQixDQUFDcUUsS0FBSyxDQUFDTSxrQkFBa0IsQ0FBQztJQUMzRTtFQUNGOztFQUVBO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNFakMsYUFBYUEsQ0FBQ3JDLFNBQVMsRUFBRWtDLElBQUksRUFBRTtJQUM3QjtJQUNBLElBQUksQ0FBQ3pDLFlBQVksQ0FBQ1ksSUFBSSxDQUFDO01BQ3JCTCxTQUFTO01BQ1RrQyxJQUFJO01BQ0pxQyxTQUFTLEVBQUUsSUFBSUMsSUFBSSxDQUFDO0lBQ3RCLENBQUMsQ0FBQzs7SUFFRjtJQUNBLElBQUksSUFBSSxDQUFDL0UsWUFBWSxDQUFDdUMsTUFBTSxHQUFHLElBQUksQ0FBQy9DLE9BQU8sQ0FBQ0ksWUFBWSxFQUFFO01BQ3hELElBQUksQ0FBQ0ksWUFBWSxDQUFDZ0YsS0FBSyxDQUFDLENBQUM7SUFDM0I7RUFDRjs7RUFFQTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7RUFDRWxDLHlCQUF5QkEsQ0FBQ3ZDLFNBQVMsRUFBRTtJQUNuQyxNQUFNcUIsVUFBVSxHQUFHLENBQUNyQixTQUFTLENBQUM7O0lBRTlCO0lBQ0EsSUFBSSxJQUFJLENBQUNmLE9BQU8sQ0FBQ0MsZ0JBQWdCLElBQUljLFNBQVMsQ0FBQ29ELFFBQVEsQ0FBQyxHQUFHLENBQUMsRUFBRTtNQUM1RCxNQUFNc0IsS0FBSyxHQUFHMUUsU0FBUyxDQUFDMkUsS0FBSyxDQUFDLEdBQUcsQ0FBQztNQUNsQztNQUNBLElBQUlDLFVBQVUsR0FBRyxFQUFFO01BQ25CLEtBQUssSUFBSVAsQ0FBQyxHQUFHLENBQUMsRUFBRUEsQ0FBQyxHQUFHSyxLQUFLLENBQUMxQyxNQUFNLEdBQUcsQ0FBQyxFQUFFcUMsQ0FBQyxFQUFFLEVBQUU7UUFDekNPLFVBQVUsR0FBR0EsVUFBVSxHQUFHLEdBQUdBLFVBQVUsSUFBSUYsS0FBSyxDQUFDTCxDQUFDLENBQUMsRUFBRSxHQUFHSyxLQUFLLENBQUNMLENBQUMsQ0FBQztRQUNoRWhELFVBQVUsQ0FBQ2hCLElBQUksQ0FBQ3VFLFVBQVUsQ0FBQztNQUM3QjtJQUNGOztJQUVBO0lBQ0EsSUFBSSxJQUFJLENBQUMzRixPQUFPLENBQUNHLGVBQWUsRUFBRTtNQUNoQztNQUNBLE1BQU15RixtQkFBbUIsR0FBRyxHQUFHO01BQy9CLElBQUlDLFlBQVksR0FBRyxDQUFDO01BRXBCLEtBQUssTUFBTXZELElBQUksSUFBSSxJQUFJLENBQUNoQyxTQUFTLENBQUNtRSxJQUFJLENBQUMsQ0FBQyxFQUFFO1FBQ3hDO1FBQ0EsSUFBSSxDQUFDbkMsSUFBSSxDQUFDNkIsUUFBUSxDQUFDLEdBQUcsQ0FBQyxFQUFFOztRQUV6QjtRQUNBLElBQUkvQixVQUFVLENBQUMrQixRQUFRLENBQUM3QixJQUFJLENBQUMsRUFBRTs7UUFFL0I7UUFDQSxJQUFJLEVBQUV1RCxZQUFZLEdBQUdELG1CQUFtQixFQUFFO1VBQ3hDO1FBQ0Y7O1FBRUE7UUFDQSxJQUFJLElBQUksQ0FBQ3hCLGdCQUFnQixDQUFDOUIsSUFBSSxFQUFFdkIsU0FBUyxDQUFDLEVBQUU7VUFDMUNxQixVQUFVLENBQUNoQixJQUFJLENBQUNrQixJQUFJLENBQUM7UUFDdkI7TUFDRjtJQUNGO0lBRUEsT0FBT0YsVUFBVTtFQUNuQjs7RUFFQTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNFZ0MsZ0JBQWdCQSxDQUFDMEIsT0FBTyxFQUFFL0UsU0FBUyxFQUFFO0lBQ25DO0lBQ0EsSUFBSStFLE9BQU8sQ0FBQy9DLE1BQU0sR0FBRyxJQUFJLElBQUloQyxTQUFTLENBQUNnQyxNQUFNLEdBQUcsSUFBSSxFQUFFO01BQ3BELE9BQU8sS0FBSztJQUNkOztJQUVBO0lBQ0EsSUFBSStDLE9BQU8sS0FBSy9FLFNBQVMsRUFBRTtNQUN6QixPQUFPLElBQUk7SUFDYjs7SUFFQTtJQUNBLElBQUkrRSxPQUFPLEtBQUssR0FBRyxFQUFFO01BQ25CLE9BQU8sQ0FBQy9FLFNBQVMsQ0FBQ29ELFFBQVEsQ0FBQyxHQUFHLENBQUM7SUFDakM7SUFFQSxJQUFJMkIsT0FBTyxLQUFLLElBQUksRUFBRTtNQUNwQixPQUFPLElBQUk7SUFDYjs7SUFFQTtJQUNBLElBQUlBLE9BQU8sQ0FBQzNCLFFBQVEsQ0FBQyxJQUFJLENBQUMsRUFBRTtNQUMxQixNQUFNc0IsS0FBSyxHQUFHSyxPQUFPLENBQUNKLEtBQUssQ0FBQyxJQUFJLENBQUM7O01BRWpDO01BQ0EsSUFBSUQsS0FBSyxDQUFDMUMsTUFBTSxHQUFHLENBQUMsRUFBRTtRQUNwQixPQUFPLEtBQUs7TUFDZDs7TUFFQTtNQUNBLElBQUkwQyxLQUFLLENBQUMxQyxNQUFNLEtBQUssQ0FBQyxJQUFJMEMsS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRTtRQUN6QyxPQUFPMUUsU0FBUyxDQUFDZ0YsVUFBVSxDQUFDTixLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7TUFDdkM7O01BRUE7TUFDQSxJQUFJQSxLQUFLLENBQUMxQyxNQUFNLEtBQUssQ0FBQyxJQUFJMEMsS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRTtRQUN6QyxPQUFPMUUsU0FBUyxDQUFDaUYsUUFBUSxDQUFDUCxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7TUFDckM7O01BRUE7TUFDQSxJQUFJQSxLQUFLLENBQUMxQyxNQUFNLEtBQUssQ0FBQyxFQUFFO1FBQ3RCLE9BQU9oQyxTQUFTLENBQUNnRixVQUFVLENBQUNOLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJMUUsU0FBUyxDQUFDaUYsUUFBUSxDQUFDUCxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7TUFDdkU7SUFDRjs7SUFFQTtJQUNBLElBQUlLLE9BQU8sQ0FBQzNCLFFBQVEsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDMkIsT0FBTyxDQUFDM0IsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFFO01BQ3BEO01BQ0EsTUFBTThCLFlBQVksR0FBR0gsT0FBTyxDQUFDSixLQUFLLENBQUMsR0FBRyxDQUFDO01BQ3ZDLE1BQU1RLFVBQVUsR0FBR25GLFNBQVMsQ0FBQzJFLEtBQUssQ0FBQyxHQUFHLENBQUM7TUFFdkMsSUFBSU8sWUFBWSxDQUFDbEQsTUFBTSxLQUFLbUQsVUFBVSxDQUFDbkQsTUFBTSxFQUFFO1FBQzdDLE9BQU8sS0FBSztNQUNkO01BRUEsS0FBSyxJQUFJcUMsQ0FBQyxHQUFHLENBQUMsRUFBRUEsQ0FBQyxHQUFHYSxZQUFZLENBQUNsRCxNQUFNLEVBQUVxQyxDQUFDLEVBQUUsRUFBRTtRQUM1QyxJQUFJYSxZQUFZLENBQUNiLENBQUMsQ0FBQyxLQUFLLEdBQUcsRUFBRTtVQUMzQixTQUFTLENBQUM7UUFDWjtRQUNBLElBQUlhLFlBQVksQ0FBQ2IsQ0FBQyxDQUFDLEtBQUtjLFVBQVUsQ0FBQ2QsQ0FBQyxDQUFDLEVBQUU7VUFDckMsT0FBTyxLQUFLO1FBQ2Q7TUFDRjtNQUNBLE9BQU8sSUFBSTtJQUNiO0lBRUEsT0FBTyxLQUFLO0VBQ2Q7QUFDRjtBQUVBZSxNQUFNLENBQUNDLE9BQU8sR0FBR3RHLFdBQVciLCJpZ25vcmVMaXN0IjpbXX0=